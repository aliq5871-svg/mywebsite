<!doctype html>
<html lang="ms" class="h-full">
 <head>
    <!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore-compat.js"></script>

<script>
 const firebaseConfig = {
  apiKey: "AIzaSyBfDXjt_-6cBG1wzhr5MUJz29VLGx_oTcc",
  authDomain: "portal-sps-ppd-kota-marudu.firebaseapp.com",
  projectId: "portal-sps-ppd-kota-marudu",
  storageBucket: "portal-sps-ppd-kota-marudu.firebasestorage.app",
  messagingSenderId: "370438750434",
  appId: "1:370438750434:web:89a9c4b515f881ffad1ebb"
};

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  window.dataSdk = {
    init(handler) {
      db.collection("sps_data")
        .orderBy("createdAt")
        .onSnapshot(snapshot => {
          const data = [];
          snapshot.forEach(doc => {
            data.push({ __backendId: doc.id, ...doc.data() });
          });
          handler.onDataChanged(data);
        });
      return Promise.resolve({ isOk: true });
    },

    create(item) {
      item.createdAt = firebase.firestore.FieldValue.serverTimestamp();
      return db.collection("sps_data").add(item)
        .then(() => ({ isOk: true }));
    },

    update(item) {
      const id = item.__backendId;
      delete item.__backendId;
      return db.collection("sps_data").doc(id).update(item)
        .then(() => ({ isOk: true }));
    },

    delete(item) {
      return db.collection("sps_data").doc(item.__backendId).delete()
        .then(() => ({ isOk: true }));
    }
  };
  </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Portal Sektor Pengurusan Sekolah - PPD Kota Marudu</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&amp;family=Inter:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      width: 100%;
      box-sizing: border-box;
    }


    body {
      font-family: 'Poppins', 'Inter', sans-serif;
      background: linear-gradient(135deg, #f6f6f6 0%, #cfe8ff 50%, #ffffff 100%);
      color: #333;
      transition: all 0.4s ease;
      overflow-x: hidden;
    }

    body.dark-mode {
      background: linear-gradient(135deg, #0a0a1a 0%, #1a1a2e 50%, #16213e 100%);
      color: #e0e0e0;
    }

    /* Header */
    header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: linear-gradient(135deg, rgba(207, 232, 255, 0.95) 0%, rgba(255, 255, 255, 0.98) 100%);
      backdrop-filter: blur(10px);
      color: #333;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 20px rgba(0, 123, 255, 0.1);
      z-index: 1000;
      animation: slideDown 0.6s ease;
      border-bottom: 1px solid rgba(207, 232, 255, 0.3);
    }

    body.dark-mode header {
      background: linear-gradient(135deg, rgba(26, 26, 46, 0.95) 0%, rgba(22, 33, 62, 0.98) 100%);
      border-bottom: 1px solid rgba(0, 123, 255, 0.3);
      box-shadow: 0 2px 20px rgba(0, 123, 255, 0.3);
    }

    @keyframes slideDown {
      from { transform: translateY(-100%); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .logo-img {
      width: 55px;
      height: 55px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid rgba(0, 123, 255, 0.3);
      box-shadow: 0 0 15px rgba(0, 123, 255, 0.2);
      transition: all 0.3s ease;
    }

    body.dark-mode .logo-img {
      border-color: rgba(0, 191, 255, 0.5);
      box-shadow: 0 0 20px rgba(0, 191, 255, 0.4);
    }

    .logo-img:hover {
      transform: scale(1.05);
      box-shadow: 0 0 25px rgba(0, 123, 255, 0.4);
    }

    body.dark-mode .logo-img:hover {
      box-shadow: 0 0 30px rgba(0, 191, 255, 0.6);
    }

    .school-info {
      display: flex;
      flex-direction: column;
    }

    .school-name {
      font-size: 1.3rem;
      font-weight: 700;
      color: #007bff;
      text-shadow: 0 2px 4px rgba(0, 123, 255, 0.1);
      transition: all 0.3s ease;
    }

    body.dark-mode .school-name {
      color: #00bfff;
      text-shadow: 0 0 10px rgba(0, 191, 255, 0.3);
    }

    .school-subtitle {
      font-size: 0.8rem;
      color: #666;
      font-weight: 400;
      margin-top: 0.2rem;
      transition: all 0.3s ease;
    }

    body.dark-mode .school-subtitle {
      color: #aaa;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .datetime {
      font-size: 0.9rem;
      color: #333;
      font-weight: 500;
      padding: 0.5rem 1rem;
      background: rgba(255, 255, 255, 0.7);
      border-radius: 20px;
      transition: all 0.3s ease;
    }

    body.dark-mode .datetime {
      color: #00bfff;
      background: rgba(255, 255, 255, 0.05);
      text-shadow: 0 0 8px rgba(0, 191, 255, 0.5);
    }

    .theme-toggle {
      background: rgba(0, 123, 255, 0.1);
      border: 2px solid rgba(0, 123, 255, 0.3);
      color: #007bff;
      width: 45px;
      height: 45px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.3rem;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 10px rgba(0, 123, 255, 0.1);
    }

    body.dark-mode .theme-toggle {
      background: rgba(0, 191, 255, 0.1);
      border-color: rgba(0, 191, 255, 0.4);
      color: #00bfff;
      box-shadow: 0 0 15px rgba(0, 191, 255, 0.3);
    }

    .theme-toggle:hover {
      background: rgba(0, 123, 255, 0.2);
      transform: rotate(180deg) scale(1.1);
      box-shadow: 0 0 20px rgba(0, 123, 255, 0.3);
    }

    body.dark-mode .theme-toggle:hover {
      background: rgba(0, 191, 255, 0.2);
      box-shadow: 0 0 25px rgba(0, 191, 255, 0.5);
    }

    .login-btn {
      background: linear-gradient(135deg, #007bff 0%, #00bfff 100%);
      color: white;
      border: none;
      padding: 0.6rem 1.3rem;
      border-radius: 25px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9rem;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 123, 255, 0.2);
    }

    body.dark-mode .login-btn {
      box-shadow: 0 0 20px rgba(0, 191, 255, 0.3);
    }

    .login-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 25px rgba(0, 123, 255, 0.4);
    }

    body.dark-mode .login-btn:hover {
      box-shadow: 0 0 30px rgba(0, 191, 255, 0.5);
    }

    /* Sidebar */
    .sidebar {
      position: fixed;
      left: 0;
      top: 85px;
      width: 280px;
      height: calc(100% - 85px);
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.95) 0%, rgba(207, 232, 255, 0.9) 100%);
      backdrop-filter: blur(10px);
      box-shadow: 4px 0 20px rgba(0, 123, 255, 0.08);
      padding: 1.5rem 0;
      overflow-y: auto;
      transition: all 0.4s ease;
      z-index: 999;
      border-right: 1px solid rgba(0, 123, 255, 0.1);
    }

    body.dark-mode .sidebar {
      background: linear-gradient(180deg, rgba(26, 26, 46, 0.95) 0%, rgba(22, 33, 62, 0.9) 100%);
      box-shadow: 4px 0 20px rgba(0, 191, 255, 0.2);
      border-right: 1px solid rgba(0, 191, 255, 0.2);
    }

    .sidebar.collapsed {
      transform: translateX(-280px);
    }

    .hamburger {
      display: none;
      position: fixed;
      left: 1rem;
      top: 100px;
      background: white;
      border: 2px solid rgba(0, 123, 255, 0.3);
      width: 50px;
      height: 50px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.5rem;
      box-shadow: 0 4px 15px rgba(0, 123, 255, 0.2);
      z-index: 1000;
      transition: all 0.3s ease;
      color: #007bff;
      align-items: center;
      justify-content: center;
    }

    body.dark-mode .hamburger {
      background: rgba(26, 26, 46, 0.95);
      color: #00bfff;
      border-color: rgba(0, 191, 255, 0.4);
      box-shadow: 0 0 20px rgba(0, 191, 255, 0.3);
    }

    .hamburger:hover {
      transform: scale(1.1);
      box-shadow: 0 0 25px rgba(0, 123, 255, 0.4);
    }

    body.dark-mode .hamburger:hover {
      box-shadow: 0 0 30px rgba(0, 191, 255, 0.5);
    }

    .nav-item {
      padding: 1rem 1.5rem;
      display: flex;
      align-items: center;
      gap: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      color: #333;
      text-decoration: none;
      font-weight: 500;
      font-size: 0.95rem;
      margin: 0.3rem 1rem;
      border-radius: 12px;
    }

    body.dark-mode .nav-item {
      color: #e0e0e0;
    }

    .nav-item:hover {
      background: linear-gradient(90deg, rgba(0, 123, 255, 0.1) 0%, transparent 100%);
      padding-left: 2rem;
      box-shadow: 0 0 15px rgba(0, 123, 255, 0.1);
    }

    body.dark-mode .nav-item:hover {
      background: linear-gradient(90deg, rgba(0, 191, 255, 0.15) 0%, transparent 100%);
      box-shadow: 0 0 20px rgba(0, 191, 255, 0.2);
    }

    .nav-item.active {
      background: linear-gradient(90deg, rgba(0, 123, 255, 0.15) 0%, rgba(0, 123, 255, 0.05) 100%);
      color: #007bff;
      box-shadow: inset 4px 0 0 #007bff;
    }

    body.dark-mode .nav-item.active {
      background: linear-gradient(90deg, rgba(0, 191, 255, 0.2) 0%, rgba(0, 191, 255, 0.05) 100%);
      color: #00bfff;
      box-shadow: inset 4px 0 0 #00bfff, 0 0 15px rgba(0, 191, 255, 0.2);
    }

    .nav-icon {
      font-size: 1.3rem;
      transition: all 0.3s ease;
    }

    .nav-item:hover .nav-icon {
      filter: drop-shadow(0 0 8px rgba(0, 123, 255, 0.5));
      transform: scale(1.15);
    }

    body.dark-mode .nav-item:hover .nav-icon {
      filter: drop-shadow(0 0 10px rgba(0, 191, 255, 0.6));
    }

    /* Main Content */
    .main-content {
      margin-left: 280px;
      margin-top: 85px;
      padding: 2rem;
      min-height: calc(100% - 85px);
      transition: all 0.4s ease;
      width: calc(100% - 280px);
      padding-bottom: 200px;
    }

    .main-content.expanded {
      margin-left: 0;
      width: 100%;
    }

    .content-area {
      animation: fadeIn 0.6s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Footer */
   footer {
  display: flex;
  align-items: center;
  justify-content: center;

  padding: 6px 12px;
  font-size: 11px;
  line-height: 1.3;

  background: #f5f8fc;
  color: #555;
}


    footer.expanded {
      margin-left: 0;
      width: 100%;
    }

    body.dark-mode footer {
      background: linear-gradient(135deg, rgba(20, 20, 35, 0.98) 0%, rgba(15, 25, 45, 0.95) 100%);
      box-shadow: 0 -4px 30px rgba(0, 191, 255, 0.2);
      border-top: 1px solid rgba(0, 191, 255, 0.25);
    }

    /* Animasi sinar bergerak */
    footer::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, 
        transparent 0%, 
        rgba(0, 123, 255, 0.08) 25%,
        rgba(0, 191, 255, 0.12) 50%,
        rgba(0, 123, 255, 0.08) 75%,
        transparent 100%);
      animation: shimmer 8s infinite linear;
    }

    body.dark-mode footer::before {
      background: linear-gradient(90deg, 
        transparent 0%, 
        rgba(0, 191, 255, 0.12) 25%,
        rgba(0, 255, 255, 0.18) 50%,
        rgba(0, 191, 255, 0.12) 75%,
        transparent 100%);
    }

    @keyframes shimmer {
      0% {
        left: -100%;
      }
      100% {
        left: 200%;
      }
    }

    .footer-content {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1.5rem;
    }

    .footer-logo {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid rgba(0, 123, 255, 0.3);
      box-shadow: 0 4px 20px rgba(0, 123, 255, 0.2);
      transition: all 0.3s ease;
    }

    body.dark-mode .footer-logo {
      border-color: rgba(0, 191, 255, 0.5);
      box-shadow: 0 0 25px rgba(0, 191, 255, 0.4);
    }

    .footer-logo:hover {
      transform: scale(1.1) rotate(5deg);
      box-shadow: 0 6px 30px rgba(0, 123, 255, 0.35);
    }

    body.dark-mode .footer-logo:hover {
      box-shadow: 0 0 35px rgba(0, 191, 255, 0.6);
    }

    .footer-text {
      text-align: center;
      color: #555;
      font-size: 0.95rem;
      line-height: 1.8;
      font-weight: 500;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      transition: all 0.3s ease;
    }

    body.dark-mode .footer-text {
      color: #bbb;
      text-shadow: 0 2px 8px rgba(0, 191, 255, 0.15);
    }

    .footer-copyright {
      text-align: center;
      color: #777;
      font-size: 0.85rem;
      padding-top: 1rem;
      border-top: 1px solid rgba(0, 123, 255, 0.1);
      width: 100%;
      max-width: 600px;
      transition: all 0.3s ease;
    }

    body.dark-mode .footer-copyright {
      color: #999;
      border-top-color: rgba(0, 191, 255, 0.2);
    }

    /* Cards */
    .card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 2rem;
      box-shadow: 0 8px 30px rgba(0, 123, 255, 0.08);
      margin-bottom: 2rem;
      transition: all 0.4s ease;
      animation: fadeIn 0.6s ease;
      border: 1px solid rgba(0, 123, 255, 0.1);
    }

    body.dark-mode .card {
      background: rgba(26, 26, 46, 0.95);
      box-shadow: 0 8px 30px rgba(0, 191, 255, 0.15);
      border-color: rgba(0, 191, 255, 0.2);
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 40px rgba(0, 123, 255, 0.15);
    }

    body.dark-mode .card:hover {
      box-shadow: 0 12px 40px rgba(0, 191, 255, 0.25);
    }

    .card-title {
      font-size: 1.8rem;
      font-weight: 700;
      color: #007bff;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 1rem;
      transition: all 0.3s ease;
    }

    body.dark-mode .card-title {
      color: #00bfff;
      text-shadow: 0 0 10px rgba(0, 191, 255, 0.3);
    }

    /* Buttons */
    .btn {
      background: linear-gradient(135deg, #007bff 0%, #00bfff 100%);
      color: white;
      border: none;
      padding: 0.8rem 1.8rem;
      border-radius: 25px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 123, 255, 0.2);
      font-size: 1rem;
      margin: 0.5rem;
    }

    body.dark-mode .btn {
      box-shadow: 0 0 20px rgba(0, 191, 255, 0.3);
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 123, 255, 0.4);
    }

    body.dark-mode .btn:hover {
      box-shadow: 0 0 30px rgba(0, 191, 255, 0.5);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .btn-delete {
      background: linear-gradient(135deg, #dc3545 0%, #ff6b7a 100%);
    }

    .btn-small {
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
    }

    .btn-like {
      background: linear-gradient(135deg, #e91e63 0%, #f06292 100%);
    }

    .btn-view {
      background: linear-gradient(135deg, #28a745 0%, #48c774 100%);
    }

    .btn-comment {
      background: linear-gradient(135deg, #ffc107 0%, #ffdb4d 100%);
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(8px);
      z-index: 2000;
      align-items: center;
      justify-content: center;
      animation: fadeIn 0.3s ease;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 2.5rem;
      max-width: 600px;
      width: 90%;
      max-height: 85%;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 123, 255, 0.3);
      animation: slideUp 0.4s ease;
      border: 1px solid rgba(0, 123, 255, 0.2);
    }

    body.dark-mode .modal-content {
      background: rgba(26, 26, 46, 0.98);
      color: #e0e0e0;
      border-color: rgba(0, 191, 255, 0.3);
      box-shadow: 0 20px 60px rgba(0, 191, 255, 0.4);
    }

    @keyframes slideUp {
      from { transform: translateY(50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .modal-title {
      font-size: 1.8rem;
      font-weight: 700;
      color: #007bff;
      margin-bottom: 1.5rem;
    }

    body.dark-mode .modal-title {
      color: #00bfff;
      text-shadow: 0 0 10px rgba(0, 191, 255, 0.3);
    }

    /* Form */
    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: #333;
    }

    body.dark-mode .form-label {
      color: #e0e0e0;
    }

    .form-input, .form-textarea {
      width: 100%;
      padding: 0.9rem;
      border: 2px solid rgba(0, 123, 255, 0.2);
      border-radius: 12px;
      font-family: 'Poppins', 'Inter', sans-serif;
      font-size: 1rem;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.9);
    }

    body.dark-mode .form-input,
    body.dark-mode .form-textarea {
      background: rgba(37, 37, 56, 0.9);
      border-color: rgba(0, 191, 255, 0.3);
      color: #e0e0e0;
    }

    .form-input:focus, .form-textarea:focus {
      outline: none;
      border-color: #007bff;
      box-shadow: 0 0 15px rgba(0, 123, 255, 0.2);
    }

    body.dark-mode .form-input:focus,
    body.dark-mode .form-textarea:focus {
      border-color: #00bfff;
      box-shadow: 0 0 20px rgba(0, 191, 255, 0.3);
    }

    /* Grid */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 2rem;
    }

    .grid-item {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 1.5rem;
      box-shadow: 0 4px 20px rgba(0, 123, 255, 0.08);
      transition: all 0.4s ease;
      border: 1px solid rgba(0, 123, 255, 0.1);
    }

    body.dark-mode .grid-item {
      background: rgba(37, 37, 56, 0.9);
      box-shadow: 0 4px 20px rgba(0, 191, 255, 0.15);
      border-color: rgba(0, 191, 255, 0.2);
    }

    .grid-item:hover {
      transform: translateY(-8px) scale(1.03);
      box-shadow: 0 12px 35px rgba(0, 123, 255, 0.2);
    }

    body.dark-mode .grid-item:hover {
      box-shadow: 0 12px 35px rgba(0, 191, 255, 0.3);
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 123, 255, 0.95);
      backdrop-filter: blur(10px);
      color: white;
      padding: 1rem 2rem;
      border-radius: 25px;
      box-shadow: 0 8px 25px rgba(0, 123, 255, 0.3);
      z-index: 3000;
      animation: toastIn 0.4s ease;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    body.dark-mode .toast {
      background: rgba(0, 191, 255, 0.95);
      box-shadow: 0 0 30px rgba(0, 191, 255, 0.5);
    }

    @keyframes toastIn {
      from { transform: translate(-50%, 100px); opacity: 0; }
      to { transform: translate(-50%, 0); opacity: 1; }
    }

    /* Comments */
    .comment-item {
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(5px);
      padding: 1rem;
      border-radius: 10px;
      margin-bottom: 1rem;
      border-left: 3px solid #007bff;
    }

    body.dark-mode .comment-item {
      background: rgba(37, 37, 56, 0.8);
      border-left-color: #00bfff;
    }

    .comment-author {
      font-weight: 600;
      color: #007bff;
      margin-bottom: 0.3rem;
    }

    body.dark-mode .comment-author {
      color: #00bfff;
    }

    .comment-text {
      color: #555;
      line-height: 1.6;
      margin-bottom: 0.5rem;
    }

    body.dark-mode .comment-text {
      color: #ccc;
    }

    .comment-date {
      font-size: 0.8rem;
      color: #999;
    }

    .interaction-buttons {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid rgba(0, 123, 255, 0.1);
      flex-wrap: wrap;
    }

    .hidden {
      display: none !important;
    }

    .loading {
      opacity: 0.6;
      pointer-events: none;
    }

    .officer-img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      object-position: center top;
      margin: 0 auto 1rem;
      display: block;
      border: 3px solid rgba(0, 123, 255, 0.3);
      box-shadow: 0 4px 15px rgba(0, 123, 255, 0.2);
    }

    body.dark-mode .officer-img {
      border-color: rgba(0, 191, 255, 0.5);
      box-shadow: 0 0 20px rgba(0, 191, 255, 0.3);
    }

    /* Responsive */
    @media (max-width: 768px) {
      .hamburger {
        display: flex;
      }

      .sidebar {
        transform: translateX(-280px);
      }

      .sidebar.mobile-open {
        transform: translateX(0);
      }

      .main-content {
        margin-left: 0;
        width: 100%;
      }

      footer {
        margin-left: 0;
        width: 100%;
      }

      .school-name {
        font-size: 1rem;
      }

      .school-subtitle {
        font-size: 0.7rem;
      }

      .datetime {
        font-size: 0.75rem;
        padding: 0.4rem 0.8rem;
      }

      .grid {
        grid-template-columns: 1fr;
      }

      header {
        padding: 0.8rem 1rem;
      }

      .logo-img {
        width: 45px;
        height: 45px;
      }

      footer {
        padding: 2rem 1.5rem;
      }

      .footer-logo {
        width: 60px;
        height: 60px;
      }
    }

    /* Hero */
    .hero {
      background: linear-gradient(135deg, rgba(207, 232, 255, 0.3) 0%, rgba(255, 255, 255, 0.5) 100%);
      border-radius: 20px;
      padding: 3rem;
      text-align: center;
      margin-bottom: 2rem;
      box-shadow: 0 8px 30px rgba(0, 123, 255, 0.1);
      animation: fadeIn 0.8s ease;
      border: 1px solid rgba(0, 123, 255, 0.1);
    }

    body.dark-mode .hero {
      background: linear-gradient(135deg, rgba(0, 191, 255, 0.1) 0%, rgba(26, 26, 46, 0.5) 100%);
      border-color: rgba(0, 191, 255, 0.2);
      box-shadow: 0 8px 30px rgba(0, 191, 255, 0.2);
    }

    .hero-title {
      font-size: 2.5rem;
      font-weight: 700;
      color: #007bff;
      margin-bottom: 1rem;
      animation: fadeIn 1s ease;
    }

    body.dark-mode .hero-title {
      color: #00bfff;
      text-shadow: 0 0 15px rgba(0, 191, 255, 0.3);
    }

    .hero-description {
      font-size: 1.1rem;
      color: #666;
      line-height: 1.6;
      animation: fadeIn 1.2s ease;
    }

    body.dark-mode .hero-description {
      color: #aaa;
    }
   /* ===============================
   CARTA ORGANISASI - KORPORAT
   =============================== */

.org-chart {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 24px;
}

.org-level {
  display: flex;
  gap: 24px;
  flex-wrap: wrap;
  justify-content: center;
}

/* Kad Jawatan */
.org-card {
  background: #ffffff;
  border: 1px solid #e5e7eb;
  border-radius: 10px;
  padding: 14px 18px;
  width: 260px;
  text-align: center;
  box-shadow: 0 4px 10px rgba(0,0,0,0.04);
}

.org-title {
  font-size: 14px;
  font-weight: 600;
  color: #1f2937;
  margin-bottom: 6px;
  text-transform: uppercase;
}

.org-name {
  font-size: 15px;
  font-weight: 500;
  color: #374151;
}

.org-unit {
  font-size: 12px;
  color: #6b7280;
  margin-top: 4px;
}

/* Responsif */
@media (max-width: 768px) {
  .org-card {
    width: 100%;
  }
/* ===============================
   CARTA ORGANISASI KORPORAT
   =============================== */

.org-chart {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
  margin-top: 1.5rem;
}

.org-level {
  display: flex;
  justify-content: center;
  gap: 20px;
  flex-wrap: wrap;
}

.org-sub {
  margin-top: 1rem;
}

/* Garisan menegak */
.org-line {
  width: 2px;
  height: 24px;
  background: #cbd5e1;
}

/* Kad Jawatan */
.org-card {
  background: #ffffff;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  padding: 14px 18px;
  min-width: 260px;
  text-align: center;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

.org-card.small {
  min-width: 200px;
}

/* Teks */
.org-title {
  font-size: 13px;
  font-weight: 600;
  color: #1f2937;
  text-transform: uppercase;
  letter-spacing: 0.4px;
}

.org-name {
  font-size: 14px;
  font-weight: 500;
  color: #475569;
  margin-top: 6px;
}

/* Mobile */
@media (max-width: 768px) {
  .org-card,
  .org-card.small {
    width: 100%;
  }

  .org-line {
    height: 16px;
  }
}


  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body class="h-full"><!-- Header -->
  <header>
   <div class="header-left"><img id="headerLogo" src="https://i.imgur.com/4EGUuTx.png" alt="Logo" class="logo-img">
    <div class="school-info">
     <h1 class="school-name" id="headerSchoolName">Sektor Pengurusan Sekolah</h1>
     <div class="school-subtitle">
      Pejabat Pendidikan Daerah Kota Marudu
     </div>
    </div>
   </div>
   <div class="header-right">
    <div class="datetime" id="datetime"></div><button class="theme-toggle" id="themeToggle">üåô</button> <button class="login-btn" id="loginBtn">Login Admin</button> <button class="login-btn hidden" id="logoutBtn">Log Keluar</button>
   </div>
  </header><!-- Hamburger Menu --> <button class="hamburger" id="hamburger">‚ò∞</button> <!-- Sidebar -->
  <nav class="sidebar" id="sidebar">
   <div class="nav-item active" data-page="utama"><span class="nav-icon">üè†</span> <span>Laman Utama</span>
   </div>
   <div class="nav-item" data-page="profil"><span class="nav-icon">üè´</span> <span>Profil Sektor</span>
   </div>
   <div class="nav-item" data-page="perkhidmatan"><span class="nav-icon">‚öôÔ∏è</span> <span>Perkhidmatan</span>
   </div>
   <div class="nav-item" data-page="dokumen"><span class="nav-icon">üìÅ</span> <span>Dokumen &amp; Borang</span>
   </div>
   <div class="nav-item" data-page="pegawai"><span class="nav-icon">üë•</span> <span>Pegawai</span>
   </div>
   <div class="nav-item" data-page="berita"><span class="nav-icon">üì∞</span> <span>Berita &amp; Aktiviti</span>
   </div>
   <div class="nav-item" data-page="perkongsian"><span class="nav-icon">ü§ù</span> <span>Perkongsian</span>
   </div>
   <div class="nav-item" data-page="pertukaran_menengah">
  <span class="nav-icon">üîÑ</span>
  <span>Pertukaran Murid Menengah</span>
</div>
   <div class="nav-item" data-page="pertukaran_rendah">
  <span class="nav-icon">üîÅ</span>
  <span>Pertukaran Murid Rendah</span>
</div>

   <div class="nav-item" data-page="statistik"><span class="nav-icon">üìä</span> <span>Statistik</span>
   </div>
   <div class="nav-item" data-page="pekeliling"><span class="nav-icon">üìã</span> <span>Pekeliling</span>
   </div>
   <div class="nav-item" data-page="bukupelawat"><span class="nav-icon">üìñ</span> <span>Buku Pelawat</span>
   </div>
  </nav><!-- Main Content -->
  <main class="main-content" id="mainContent">
   <div class="content-area" id="contentArea"></div>
  </main><!-- Footer -->
  <footer id="footer">
   <div class="footer-content">
    <div class="footer-copyright" id="footerCopyright">
     ¬© 2025 Sektor Pengurusan Sekolah. Hak Cipta Terpelihara.
    </div>
   </div>
  </footer><!-- Login Modal -->
  <div class="modal" id="loginModal">
   <div class="modal-content">
    <h2 class="modal-title">Login Admin</h2>
    <form id="loginForm">
     <div class="form-group"><label class="form-label" for="loginUsername">Nama Pengguna</label> <input type="text" class="form-input" id="loginUsername" required>
     </div>
     <div class="form-group"><label class="form-label" for="loginPassword">Kata Laluan</label> <input type="password" class="form-input" id="loginPassword" required>
     </div><button type="submit" class="btn">Login</button> <button type="button" class="btn btn-delete" onclick="closeLoginModal()">Batal</button>
    </form>
   </div>
  </div><!-- Generic Modal -->
  <div class="modal" id="genericModal">
   <div class="modal-content">
    <h2 class="modal-title" id="modalTitle">Modal</h2>
    <div id="modalBody"></div>
   </div>
  </div>
  <script>
    let allData = [];
    let currentPage = 'utama';
    let isAdmin = false;
    let isSuperAdmin = false;
    let currentUser = null;

    const dataHandler = {
      onDataChanged(data) {
        allData = data;
        renderCurrentPage();
        updateHeader();
        updateFooter();
      }
    };

    async function init() {
      const result = await window.dataSdk.init(dataHandler);
      if (!result.isOk) {
        showToast('‚ùå Sistem tidak tersedia');
        return;
      }

      setupEventListeners();
      updateDateTime();
      setInterval(updateDateTime, 1000);
      checkLoginStatus();
    }

    function setupEventListeners() {
      document.getElementById('loginBtn').addEventListener('click', () => {
        document.getElementById('loginModal').classList.add('active');
      });
      
      document.getElementById('loginForm').addEventListener('submit', handleLogin);
      document.getElementById('logoutBtn').addEventListener('click', logout);
      document.getElementById('themeToggle').addEventListener('click', toggleTheme);
      document.getElementById('hamburger').addEventListener('click', toggleSidebar);

      document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', function() {
          const page = this.getAttribute('data-page');
          if (page) {
            currentPage = page;
            document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
            this.classList.add('active');
            renderCurrentPage();
            
            if (window.innerWidth <= 768) {
              document.getElementById('sidebar').classList.remove('mobile-open');
            }
          }
        });
      });
    }

    function updateDateTime() {
      const now = new Date();
      const day = String(now.getDate()).padStart(2, '0');
      const months = ['Jan', 'Feb', 'Mac', 'Apr', 'Mei', 'Jun', 'Jul', 'Ogos', 'Sep', 'Okt', 'Nov', 'Dis'];
      const month = months[now.getMonth()];
      const year = now.getFullYear();
      const hours = String(now.getHours()).padStart(2, '0');
      const minutes = String(now.getMinutes()).padStart(2, '0');
      
      document.getElementById('datetime').textContent = `${day} ${month} ${year}, ${hours}:${minutes}`;
    }

    function toggleTheme() {
      document.body.classList.toggle('dark-mode');
      const isDark = document.body.classList.contains('dark-mode');
      document.getElementById('themeToggle').textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
      localStorage.setItem('darkMode', isDark);
    }

    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const mainContent = document.getElementById('mainContent');
      const footer = document.getElementById('footer');
      
      sidebar.classList.toggle('mobile-open');
      
      if (window.innerWidth > 768) {
        const isCollapsed = sidebar.classList.contains('collapsed');
        sidebar.classList.toggle('collapsed');
        mainContent.classList.toggle('expanded');
        footer.classList.toggle('expanded');
      }
    }

    function updateHeader() {
      const profile = allData.find(d => d.type === 'profile');
      if (profile) {
        if (profile.school_name) {
          document.getElementById('headerSchoolName').textContent = profile.school_name;
        }
        if (profile.logo_url) {
          document.getElementById('headerLogo').src = profile.logo_url;
        }
      }
    }

    function updateFooter() {
      const profile = allData.find(d => d.type === 'profile');
      if (profile && profile.copyright_text) {
        document.getElementById('footerCopyright').textContent = profile.copyright_text;
      }
    }

    async function handleLogin(e) {
      e.preventDefault();
      const username = document.getElementById('loginUsername').value.trim();
      const password = document.getElementById('loginPassword').value.trim();

      const users = allData.filter(d => d.type === 'user');
      let user = users.find(u => u.username === username && u.password === password);

      if (!user) {
        if (username === 'admin' && password === 'adminsps') {
          const newUser = {
            type: 'user',
            username: 'admin',
            password: 'adminsps',
            role: 'admin',
            timestamp: new Date().toISOString()
          };
          const result = await window.dataSdk.create(newUser);
          if (result.isOk) {
            user = { ...newUser, __backendId: 'temp' };
          }
        } else if (username === 'superadmin' && password === 'akuadmin') {
          const newUser = {
            type: 'user',
            username: 'superadmin',
            password: 'akuadmin',
            role: 'superadmin',
            timestamp: new Date().toISOString()
          };
          const result = await window.dataSdk.create(newUser);
          if (result.isOk) {
            user = { ...newUser, __backendId: 'temp' };
          }
        }
      }

      if (user) {
        isAdmin = true;
        isSuperAdmin = user.role === 'superadmin';
        currentUser = user;
        localStorage.setItem('isLoggedIn', 'true');
        localStorage.setItem('currentUser', JSON.stringify(user));
        closeLoginModal();
        document.getElementById('loginBtn').classList.add('hidden');
        document.getElementById('logoutBtn').classList.remove('hidden');
        showToast('‚úÖ Login berjaya!');
        renderCurrentPage();
      } else {
        showToast('‚ùå Nama pengguna atau kata laluan salah');
      }
    }

    function checkLoginStatus() {
      const loggedIn = localStorage.getItem('isLoggedIn');
      const userStr = localStorage.getItem('currentUser');
      if (loggedIn === 'true' && userStr) {
        try {
          currentUser = JSON.parse(userStr);
          isAdmin = true;
          isSuperAdmin = currentUser.role === 'superadmin';
          document.getElementById('loginBtn').classList.add('hidden');
          document.getElementById('logoutBtn').classList.remove('hidden');
        } catch (e) {
          logout();
        }
      }
    }

    function logout() {
      isAdmin = false;
      isSuperAdmin = false;
      currentUser = null;
      localStorage.removeItem('isLoggedIn');
      localStorage.removeItem('currentUser');
      document.getElementById('loginBtn').classList.remove('hidden');
      document.getElementById('logoutBtn').classList.add('hidden');
      showToast('‚úÖ Log keluar berjaya');
      renderCurrentPage();
    }

    function closeLoginModal() {
      document.getElementById('loginModal').classList.remove('active');
    }

    function closeModal() {
      document.getElementById('genericModal').classList.remove('active');
    }

    function renderCurrentPage() {
      switch (currentPage) {
        case 'utama':
          renderUtama();
          break;
        case 'profil':
          renderProfil();
          break;
        case 'perkhidmatan':
          renderPerkhidmatan();
          break;
        case 'dokumen':
          renderDokumen();
          break;
        case 'pegawai':
          renderPegawai();
          break;
        case 'berita':
          renderBerita();
          break;
        case 'bukupelawat':
          renderBukuPelawat();
          break;
        case 'perkongsian':
          renderPerkongsian();
          break;
        case 'pertukaran_menengah':
  renderPertukaranMenengah();
  break;
        case 'pertukaran_rendah':
  renderPertukaranRendah();
  break;

        case 'statistik':
          renderStatistik();
          break;
        case 'pekeliling':
          renderPekeliling();
          break;
      }
    }

    function renderUtama() {
      const content = document.getElementById('contentArea');
      const profile = allData.find(d => d.type === 'profile');
      
      const totalOfficers = allData.filter(d => d.type === 'officer').length;
      const totalNews = allData.filter(d => d.type === 'news').length;
      const totalDocuments = allData.filter(d => d.type === 'document').length;
      const totalSharing = allData.filter(d => d.type === 'sharing').length;
      
      content.innerHTML = `
        <div class="hero">
          <h1 class="hero-title">Selamat Datang</h1>
          <p class="hero-description">Portal Rasmi Sektor Pengurusan Sekolah<br>Pejabat Pendidikan Daerah Kota Marudu</p>
        </div>

        <div class="card">
          <h2 class="card-title">üìö Visi & Misi</h2>
          <h3 style="color: #007bff; margin-bottom: 0.5rem; font-size: 1.3rem;">Visi</h3>
          <p style="margin-bottom: 1.5rem; line-height: 1.8; color: #555;">
            ${profile && profile.vision ? profile.vision : 'Pendidikan Berkualiti, Insan Terdidik, Negara Sejahtera.'}
          </p>
          
          <h3 style="color: #007bff; margin-bottom: 0.5rem; font-size: 1.3rem;">Misi</h3>
          <p style="line-height: 1.8; color: #555;">
            ${profile && profile.mission ? profile.mission : 'Melestarikan sistem pendidikan yang berkualiti untuk membangunkan potensi individu bagi memenuhi aspirasi negara.'}
          </p>
        </div>

        <div class="card">
          <h2 class="card-title">üéØ Fokus Utama & Fungsi</h2>
          <div class="grid">
            <div class="grid-item">
              <h3 style="color: #007bff; margin-bottom: 0.8rem; font-size: 1.2rem;">üè´ 1. Memastikan Pengoperasian Sekolah Yang Efektif</h3>
              <p style="line-height: 1.6; color: #666;">Menjamin semua sekolah dalam daerah beroperasi dengan teratur, mematuhi dasar KPM, serta mengekalkan persekitaran pembelajaran selamat dan kondusif.</p>
            </div>
            <div class="grid-item">
              <h3 style="color: #007bff; margin-bottom: 0.8rem; font-size: 1.2rem;">üë®‚Äçüíº 2. Meningkatkan Kualiti Kepimpinan & Pengurusan Sekolah</h3>
              <p style="line-height: 1.6; color: #666;">Memperkasakan kepimpinan Pengetua/Guru Besar melalui bimbingan, pemantauan dan intervensi berfokus.</p>
            </div>
            <div class="grid-item">
              <h3 style="color: #007bff; margin-bottom: 0.8rem; font-size: 1.2rem;">üìö 3. Memacu Prestasi Akademik & Sahsiah Murid</h3>
              <p style="line-height: 1.6; color: #666;">Menyokong pelaksanaan kurikulum, PBD, program intervensi akademik serta memastikan kesejahteraan dan perkembangan murid.</p>
            </div>
            <div class="grid-item">
              <h3 style="color: #007bff; margin-bottom: 0.8rem; font-size: 1.2rem;">üìä 4. Menjamin Ketepatan & Integriti Data Pendidikan</h3>
              <p style="line-height: 1.6; color: #666;">Mengurus, menyelaras dan memantau data sekolah (APDM, EMIS, SPLKPM, e-Operasi dan lain-lain) untuk keputusan yang tepat.</p>
            </div>
            <div class="grid-item">
              <h3 style="color: #007bff; margin-bottom: 0.8rem; font-size: 1.2rem;">‚úÖ 5. Memastikan Pematuhan Dasar & Keperluan Perundangan</h3>
              <p style="line-height: 1.6; color: #666;">Melaksanakan pemantauan kepatuhan dalam aspek kurikulum, keselamatan, disiplin, pentadbiran dan pengurusan sekolah.</p>
            </div>
          </div>
        </div>

        <div class="card">
          <h2 class="card-title">üìä Statistik Ringkas</h2>
          <div class="grid">
            <div class="grid-item" style="background: linear-gradient(135deg, rgba(0, 123, 255, 0.1) 0%, rgba(0, 191, 255, 0.05) 100%); border-left: 4px solid #007bff; text-align: center;">
              <div style="font-size: 3rem; margin-bottom: 0.5rem;">üë•</div>
              <h3 style="font-size: 2.5rem; font-weight: 700; color: #007bff; margin-bottom: 0.5rem;">${totalOfficers}</h3>
              <p style="color: #666; font-weight: 600;">Jumlah Pegawai</p>
            </div>
            
            <div class="grid-item" style="background: linear-gradient(135deg, rgba(0, 191, 255, 0.1) 0%, rgba(0, 123, 255, 0.05) 100%); border-left: 4px solid #00bfff; text-align: center;">
              <div style="font-size: 3rem; margin-bottom: 0.5rem;">üì∞</div>
              <h3 style="font-size: 2.5rem; font-weight: 700; color: #00bfff; margin-bottom: 0.5rem;">${totalNews}</h3>
              <p style="color: #666; font-weight: 600;">Berita & Aktiviti</p>
            </div>
            
            <div class="grid-item" style="background: linear-gradient(135deg, rgba(0, 123, 255, 0.1) 0%, rgba(0, 191, 255, 0.05) 100%); border-left: 4px solid #007bff; text-align: center;">
              <div style="font-size: 3rem; margin-bottom: 0.5rem;">üìÑ</div>
              <h3 style="font-size: 2.5rem; font-weight: 700; color: #007bff; margin-bottom: 0.5rem;">${totalDocuments}</h3>
              <p style="color: #666; font-weight: 600;">Dokumen</p>
            </div>
            
            <div class="grid-item" style="background: linear-gradient(135deg, rgba(0, 191, 255, 0.1) 0%, rgba(0, 123, 255, 0.05) 100%); border-left: 4px solid #00bfff; text-align: center;">
              <div style="font-size: 3rem; margin-bottom: 0.5rem;">ü§ù</div>
              <h3 style="font-size: 2.5rem; font-weight: 700; color: #00bfff; margin-bottom: 0.5rem;">${totalSharing}</h3>
              <p style="color: #666; font-weight: 600;">Perkongsian</p>
            </div>
          </div>
        </div>
      `;
    }

   function renderProfil() {
  const content = document.getElementById('contentArea');
const profile = allData.find(d => d.type === 'profile') || {};
  content.innerHTML = `
    <!-- ================= PROFIL SEKTOR ================= -->
    <div class="card">
      <h2 class="card-title">Profil Sektor</h2>
      ${isSuperAdmin ? `
        <button class="btn" onclick="changePassword()">
          Tukar Kata Laluan
        </button>
      ` : ''}

      <div style="margin-top: 2rem;">
        <h3 style="color:#1d4ed8; margin-bottom:1rem;">
          Latar Belakang
        </h3>

        <p style="line-height:1.8; color:#374151; text-align:justify;">
          Sektor Pengurusan Sekolah (SPS) di Pejabat Pendidikan Daerah (PPD)
          bertanggungjawab mengurus tadbir, operasi dan pentadbiran sekolah
          kerajaan, bantuan kerajaan dan swasta di peringkat daerah.
          Tanggungjawab ini merangkumi pengurusan guru dan murid, data sekolah,
          penempatan serta pertukaran, pematuhan kurikulum dan pengurusan
          pentadbiran am selaras dengan dasar Kementerian Pendidikan Malaysia.
        </p>
      </div>
    </div>

    <!-- ================= CARTA ORGANISASI ================= -->
    <div class="card">
      <h2 class="card-title">Carta Organisasi</h2>

      <div class="org-chart">

        <div class="org-level">
          <div class="org-card">
            <div class="org-title">Pegawai Pendidikan Daerah</div>
            <div class="org-name">PPD Kota Marudu</div>
          </div>
        </div>

        <div class="org-line"></div>

        <div class="org-level">
          <div class="org-card">
            <div class="org-title">Timbalan Pegawai Pendidikan Daerah</div>
            <div class="org-name">Sektor Pengurusan Sekolah</div>
          </div>
        </div>

        <div class="org-line"></div>

        <div class="org-level">
          <div class="org-card">
            <div class="org-title">School Improvement Partner Plus (SIP+)</div>
            <div class="org-name">PPD Kota Marudu</div>
          </div>
        </div>

        <div class="org-line"></div>

        <div class="org-level">
          <div class="org-card">
            <div class="org-title">Sektor Pengurusan Sekolah</div>
            <div class="org-name">Unit Operasi & Pentadbiran</div>
          </div>
        </div>

        <div class="org-level org-sub">
          <div class="org-card small">
            <div class="org-title">Unit Prasekolah</div>
          </div>

          <div class="org-card small">
            <div class="org-title">Unit Rendah</div>
          </div>

          <div class="org-card small">
            <div class="org-title">Unit Menengah & Tingkatan Enam</div>
          </div>

          <div class="org-card small">
            <div class="org-title">Unit Swasta</div>
          </div>
        </div>

      </div>
    </div>
      <div class="card">
          <h2 class="card-title">üìû Maklumat Perhubungan</h2>
          <div style="line-height: 2; color: #555;">
            <div style="background: linear-gradient(135deg, rgba(0, 123, 255, 0.05) 0%, rgba(0, 191, 255, 0.02) 100%); padding: 1.5rem; border-radius: 12px; border-left: 4px solid #007bff; margin-bottom: 1.5rem;">
              <p style="margin-bottom: 0.8rem;"><strong style="color: #007bff;">üìç Alamat</strong></p>
              <p style="margin: 0; line-height: 1.8;">${profile && profile.address ? profile.address : 'Pejabat Pendidikan Daerah Kota Marudu<br>Peti Surat 89108<br>89108 Kota Marudu, Sabah'}</p>
            </div>
            
            <div style="background: linear-gradient(135deg, rgba(0, 123, 255, 0.05) 0%, rgba(0, 191, 255, 0.02) 100%); padding: 1.5rem; border-radius: 12px; border-left: 4px solid #007bff; margin-bottom: 1.5rem;">
              <p style="margin-bottom: 0.8rem;"><strong style="color: #007bff;">üìû Telefon:</strong> 088-661234 / 088-662511</p>
              <p style="margin-bottom: 0.8rem;"><strong style="color: #007bff;">üì† Faks:</strong> 088-662511</p>
              <p><strong style="color: #007bff;">üìß Email:</strong> ppdkotamarudu@moe.gov.my</p>
            </div>
            
            <div style="background: linear-gradient(135deg, rgba(0, 123, 255, 0.05) 0%, rgba(0, 191, 255, 0.02) 100%); padding: 1.5rem; border-radius: 12px; border-left: 4px solid #007bff;">
              <p style="margin-bottom: 0.8rem;"><strong style="color: #007bff;">üïê Waktu Operasi</strong></p>
              <p style="margin-bottom: 0.5rem;">Isnin - Khamis: 8:00 AM - 5:00 PM</p>
              <p style="margin-bottom: 0.5rem;">Jumaat: 8:00 AM - 12:15 PM, 2:45 PM - 5:00 PM</p>
              <p style="color: #999; font-size: 0.9rem; margin-top: 0.8rem;">* Tutup pada hujung minggu dan cuti umum</p>
            </div>
          </div>
        </div>
  `;
}


    function renderPerkhidmatan() {
      const content = document.getElementById('contentArea');
      
      content.innerHTML = `
        <div class="card">
          <h2 class="card-title">üõ†Ô∏è Perkhidmatan</h2>
          <p style="font-size: 1.1rem; color: #666; margin-bottom: 2rem; line-height: 1.8;">Perkhidmatan yang disediakan kepada sekolah</p>
          
          <div class="grid">
            <div class="grid-item">
              <h3 style="color: #007bff; margin-bottom: 0.8rem; font-size: 1.2rem;">üè´ 1. Mengurus dan Menyelaras Hal Ehwal Sekolah</h3>
              <p style="line-height: 1.8; color: #666; text-align: justify;">
                Memastikan semua sekolah di bawah PPD beroperasi dengan teratur dan mematuhi standard KPM. 
                Menyemak, memantau dan menyelaras pelaksanaan dasar serta arahan pendidikan. 
                Menyelaras isu-isu pengoperasian sekolah termasuk fasiliti, jadual waktu, keselamatan dan hal pentadbiran.
              </p>
            </div>
            
            <div class="grid-item">
              <h3 style="color: #007bff; margin-bottom: 0.8rem; font-size: 1.2rem;">üîç 2. Melaksanakan Pemantauan dan Bimbingan Profesional</h3>
              <p style="line-height: 1.8; color: #666; text-align: justify;">
                Melaksanakan pemantauan berfokus dan lawatan ke sekolah. 
                Memberi bimbingan kepada pentadbir sekolah (Guru Besar, Pengetua, PK). 
                Mengesan keperluan intervensi meningkatkan prestasi sekolah.
              </p>
            </div>
            
            <div class="grid-item">
              <h3 style="color: #007bff; margin-bottom: 0.8rem; font-size: 1.2rem;">üìä 3. Mengurus Data, Pelaporan & Pematuhan</h3>
              <p style="line-height: 1.8; color: #666; text-align: justify;">
                Menyelia pelaporan EMIS, APDM, e-Operasi, PADU dan sistem KPM lain. 
                Memastikan ketepatan, ketepatan masa dan kesahan data sekolah. 
                Mengawal selia pematuhan dasar seperti LINUS, MBMMBI, DSKP, keselamatan dan kehadiran murid.
              </p>
            </div>
            
            <div class="grid-item">
              <h3 style="color: #007bff; margin-bottom: 0.8rem; font-size: 1.2rem;">üìö 4. Menyokong Pelaksanaan Kurikulum & Program Pendidikan</h3>
              <p style="line-height: 1.8; color: #666; text-align: justify;">
                Menyelaras pelaksanaan kurikulum tahap rendah dan menengah. 
                Memantau standard pembelajaran, pencapaian akademik dan intervensi bilik darjah. 
                Memberi sokongan kepada pelaksana program seperti PdPR, MBK, PBD dan projek inovasi sekolah.
              </p>
            </div>
            
            <div class="grid-item">
              <h3 style="color: #007bff; margin-bottom: 0.8rem; font-size: 1.2rem;">üë• 5. Mengurus Sumber Manusia Sekolah</h3>
              <p style="line-height: 1.8; color: #666; text-align: justify;">
                Menyemak dan mengesahkan keperluan guru, AKP dan jawatan sokongan. 
                Menyelia urusan penempatan, pertukaran, pengisian jawatan dan kelulusan waran perjawatan. 
                Membantu guru baharu (SISC+, SIP+ terlibat secara kolaboratif).
              </p>
            </div>
            
            <div class="grid-item">
              <h3 style="color: #007bff; margin-bottom: 0.8rem; font-size: 1.2rem;">‚ö†Ô∏è 6. Menangani Aduan, Isu & Krisis Sekolah</h3>
              <p style="line-height: 1.8; color: #666; text-align: justify;">
                Mengurus aduan masyarakat, ibu bapa dan warga sekolah. 
                Menangani isu disiplin murid, keselamatan sekolah, konflik dalaman dan kebajikan. 
                Berperanan sebagai perantara antara sekolah dengan JPN/KPM.
              </p>
            </div>
            
            <div class="grid-item">
              <h3 style="color: #007bff; margin-bottom: 0.8rem; font-size: 1.2rem;">üöÄ 7. Menyelaras Program Pembangunan Sekolah</h3>
              <p style="line-height: 1.8; color: #666; text-align: justify;">
                Merancang dan melaksana program peningkatan profesionalisme pemimpin sekolah. 
                Menggerakkan program transformasi seperti TS25, Sekolah Amanah, sekolah sangat daif, dan program kecemerlangan. 
                Mengukuhkan budaya kualiti dalam kepimpinan dan pengurusan sekolah.
              </p>
            </div>
          </div>
        </div>
      `;
    }

    async function toggleLike(itemId) {
      const item = allData.find(d => d.__backendId === itemId);
      if (!item) return;

      const currentLikes = item.likes || 0;
      const result = await window.dataSdk.update({
        ...item,
        likes: currentLikes + 1
      });

      if (result.isOk) {
        showToast('‚ù§Ô∏è Terima kasih!');
      } else {
        showToast('‚ùå Gagal menyukai');
      }
    }

    async function viewItem(itemId) {
      const item = allData.find(d => d.__backendId === itemId);
      if (!item) return;

      const currentViews = item.views || 0;
      const result = await window.dataSdk.update({
        ...item,
        views: currentViews + 1
      });

      if (result.isOk) {
        showToast('üëÅÔ∏è Dilihat');
      }
    }

    function showComments(itemId, itemType) {
      const item = allData.find(d => d.__backendId === itemId);
      if (!item) return;

      const comments = allData.filter(d => 
        d.type === 'interaction' && 
        d.parent_id === itemId && 
        d.interaction_type === 'comment'
      );

      const modal = document.getElementById('genericModal');
      document.getElementById('modalTitle').textContent = 'üí¨ Komen';
      
      let commentsHTML = comments.length === 0 ? 
        '<p style="text-align: center; color: #999; padding: 2rem;">Tiada komen</p>' :
        comments.map(comment => `
          <div class="comment-item">
            <div class="comment-author">${comment.user_name || 'Tetamu'}</div>
            <div class="comment-text">${comment.comment_text}</div>
            <div class="comment-date">${new Date(comment.timestamp).toLocaleDateString('ms-MY')}</div>
            ${isAdmin ? `<button class="btn btn-delete btn-small" onclick="deleteComment('${comment.__backendId}')" style="margin-top: 0.5rem;">Padam</button>` : ''}
          </div>
        `).join('');

      document.getElementById('modalBody').innerHTML = `
        <div style="margin-bottom: 2rem;">
          ${commentsHTML}
        </div>
        <form id="commentForm">
          <div class="form-group">
            <label class="form-label" for="commentName">Nama Anda</label>
            <input type="text" class="form-input" id="commentName" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="commentText">Komen</label>
            <textarea class="form-textarea" id="commentText" rows="3" required></textarea>
          </div>
          <button type="submit" class="btn">Hantar Komen</button>
          <button type="button" class="btn btn-delete" onclick="closeModal()">Tutup</button>
        </form>
      `;
      
      modal.classList.add('active');

      document.getElementById('commentForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const result = await window.dataSdk.create({
          type: 'interaction',
          parent_id: itemId,
          interaction_type: 'comment',
          user_name: document.getElementById('commentName').value,
          comment_text: document.getElementById('commentText').value,
          timestamp: new Date().toISOString()
        });

        if (result.isOk) {
          showToast('‚úÖ Komen dihantar');
          closeModal();
        } else {
          showToast('‚ùå Gagal hantar komen');
        }
      });
    }

    async function deleteComment(commentId) {
      const comment = allData.find(d => d.__backendId === commentId);
      if (!comment) return;

      const result = await window.dataSdk.delete(comment);
      if (result.isOk) {
        showToast('‚úÖ Komen dipadam');
        closeModal();
      } else {
        showToast('‚ùå Gagal padam komen');
      }
    }

    function renderDokumen() {
      const content = document.getElementById('contentArea');
      const dokumen = allData.filter(d => d.type === 'document');
      
      content.innerHTML = `
        <div class="card">
          <h2 class="card-title">üìÅ Dokumen & Borang</h2>
          ${isAdmin ? '<button class="btn" onclick="addDocument()">+ Tambah Dokumen</button>' : ''}
          
          ${dokumen.length === 0 ? 
            '<p style="text-align: center; color: #999; padding: 2rem;">Tiada dokumen tersedia</p>' :
            dokumen.map(doc => {
              const likes = doc.likes || 0;
              const views = doc.views || 0;
              const commentCount = allData.filter(d => d.type === 'interaction' && d.parent_id === doc.__backendId && d.interaction_type === 'comment').length;
              
              return `
              <div class="grid-item" style="margin-bottom: 1rem;">
                <h3 style="color: #007bff; margin-bottom: 0.5rem;">üìÑ ${doc.title}</h3>
                <p style="color: #666; margin-bottom: 0.5rem;">${doc.description || ''}</p>
                <p style="font-size: 0.9rem; color: #999;">${doc.category || ''}</p>
                ${doc.download_link ? `<p style="font-size: 0.9rem; color: #28a745; margin-top: 0.5rem;">üîó <a href="${doc.download_link}" target="_blank" rel="noopener noreferrer" style="color: #28a745; text-decoration: underline;">Muat Turun</a></p>` : ''}
                
                <div class="interaction-buttons">
                  <button class="btn btn-small btn-like" onclick="toggleLike('${doc.__backendId}')">
                    ‚ù§Ô∏è Suka (${likes})
                  </button>
                  <button class="btn btn-small btn-view" onclick="viewItem('${doc.__backendId}')">
                    üëÅÔ∏è Lihat (${views})
                  </button>
                  <button class="btn btn-small btn-comment" onclick="showComments('${doc.__backendId}', 'document')">
                    üí¨ Komen (${commentCount})
                  </button>
                </div>
                ${isAdmin ? `
                  <div style="margin-top: 0.5rem;">
                    <button class="btn btn-small" onclick="editDocument('${doc.__backendId}')">‚úèÔ∏è Edit</button>
                    <button class="btn btn-delete btn-small" onclick="deleteItem('${doc.__backendId}')">Padam</button>
                  </div>
                ` : ''}
              </div>
            `;
            }).join('')
          }
        </div>
      `;
    }

    function renderPegawai() {
      const content = document.getElementById('contentArea');
      const pegawai = allData.filter(d => d.type === 'officer');
      
      content.innerHTML = `
        <div class="card">
          <h2 class="card-title">üë• Pegawai</h2>
          ${isAdmin ? '<button class="btn" onclick="addOfficer()">+ Tambah Pegawai</button>' : ''}
          
          <div class="grid">
            ${pegawai.length === 0 ? 
              '<p style="grid-column: 1/-1; text-align: center; color: #999; padding: 2rem;">Tiada maklumat pegawai</p>' :
              pegawai.map(officer => `
                <div class="grid-item" style="text-align: center;">
                  ${officer.image_url ? 
                    `<img src="${officer.image_url}" alt="${officer.name}" class="officer-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <div style="width: 100px; height: 100px; background: linear-gradient(135deg, #007bff 0%, #00bfff 100%); border-radius: 50%; margin: 0 auto 1rem; display: none; align-items: center; justify-content: center; font-size: 3rem;">üë§</div>` :
                    `<div style="width: 100px; height: 100px; background: linear-gradient(135deg, #007bff 0%, #00bfff 100%); border-radius: 50%; margin: 0 auto 1rem; display: flex; align-items: center; justify-content: center; font-size: 3rem;">üë§</div>`
                  }
                  <h3 style="color: #007bff; margin-bottom: 0.5rem; font-size: 1.2rem;">${officer.name}</h3>
                  <p style="font-weight: 600; margin-bottom: 0.5rem; color: #666;">${officer.position}</p>
                  ${officer.unit ? `<p style="font-size: 0.9rem; color: #007bff; margin-bottom: 0.5rem;">üè¢ ${officer.unit}</p>` : ''}
                  ${officer.email ? `<p style="font-size: 0.9rem; color: #999;">üìß ${officer.email}</p>` : ''}
                  ${officer.phone ? `<p style="font-size: 0.9rem; color: #999;">üìû ${officer.phone}</p>` : ''}
                  ${isAdmin ? `
                    <div style="margin-top: 1rem;">
                      <button class="btn btn-small" onclick="editOfficer('${officer.__backendId}')">‚úèÔ∏è Edit</button>
                      <button class="btn btn-delete btn-small" onclick="deleteItem('${officer.__backendId}')">Padam</button>
                    </div>
                  ` : ''}
                </div>
              `).join('')
            }
          </div>
        </div>
      `;
    }

    function renderBerita() {
      const content = document.getElementById('contentArea');
      const berita = allData.filter(d => d.type === 'news');
      
      content.innerHTML = `
        <div class="card">
          <h2 class="card-title">üì∞ Berita & Aktiviti</h2>
          ${isAdmin ? '<button class="btn" onclick="addNews()">+ Tambah Berita</button>' : ''}
          
          <div class="grid">
            ${berita.length === 0 ? 
              '<p style="grid-column: 1/-1; text-align: center; color: #999; padding: 2rem;">Tiada berita</p>' :
              berita.map(news => {
                const likes = news.likes || 0;
                const views = news.views || 0;
                const commentCount = allData.filter(d => d.type === 'interaction' && d.parent_id === news.__backendId && d.interaction_type === 'comment').length;
                
                return `
                <div class="grid-item">
                ${news.image_url ? `
  <img src="${news.image_url}"
       style="width:100%; height:180px; object-fit:cover; border-radius:12px; margin-bottom:0.8rem;"
       onerror="this.style.display='none'">
` : ''}

                  <p style="font-size: 0.85rem; color: #007bff; font-weight: 600; margin-bottom: 0.5rem;">${news.date || ''}</p>
                  <h3 style="color: #333; margin-bottom: 0.8rem; font-size: 1.2rem;">${news.title}</h3>
                  <p style="line-height: 1.6; color: #666;">${news.description || ''}</p>
                  ${news.download_link ? `<p style="font-size: 0.9rem; color: #28a745; margin-top: 0.5rem;">üîó <a href="${news.download_link}" target="_blank" rel="noopener noreferrer" style="color: #28a745; text-decoration: underline;">Muat Turun Lampiran</a></p>` : ''}
                  
                  <div class="interaction-buttons">
                    <button class="btn btn-small btn-like" onclick="toggleLike('${news.__backendId}')">
                      ‚ù§Ô∏è Suka (${likes})
                    </button>
                    <button class="btn btn-small btn-view" onclick="viewItem('${news.__backendId}')">
                      üëÅÔ∏è Lihat (${views})
                    </button>
                    <button class="btn btn-small btn-comment" onclick="showComments('${news.__backendId}', 'news')">
                       üí¨ Komen (${commentCount})
                    </button>
                  </div>
                  ${isAdmin ? `
                    <div style="margin-top: 0.5rem;">
                      <button class="btn btn-small" onclick="editNews('${news.__backendId}')">‚úèÔ∏è Edit</button>
                      <button class="btn btn-delete btn-small" onclick="deleteItem('${news.__backendId}')">Padam</button>
                    </div>
                  ` : ''}
                </div>
              `;
              }).join('')
            }
          </div>
        </div>
      `;
    }

    function renderBukuPelawat() {
      const content = document.getElementById('contentArea');
      const messages = allData.filter(d => d.type === 'guestbook');
      
      content.innerHTML = `
        <div class="card">
          <h2 class="card-title">üìñ Buku Pelawat</h2>
          <button class="btn" onclick="addGuestbookEntry()">‚úçÔ∏è Tulis Mesej</button>
          
          <div style="margin-top: 2rem;">
            ${messages.length === 0 ? 
              '<p style="text-align: center; color: #999; padding: 2rem;">Tiada mesej</p>' :
              messages.map(msg => {
                const likes = msg.likes || 0;
                const views = msg.views || 0;
                const commentCount = allData.filter(d => d.type === 'interaction' && d.parent_id === msg.__backendId && d.interaction_type === 'comment').length;
                
                return `
                <div style="background: rgba(255, 255, 255, 0.9); padding: 1.5rem; border-radius: 15px; margin-bottom: 1rem; border-left: 4px solid #007bff;">
                  <p style="font-weight: 600; color: #007bff; margin-bottom: 0.5rem;">${msg.visitor_name || 'Tetamu'}</p>
                  <p style="line-height: 1.6; color: #555; margin-bottom: 0.5rem;">${msg.message}</p>
                  <p style="font-size: 0.85rem; color: #999;">${msg.date || ''}</p>
                  
                  <div class="interaction-buttons">
                    <button class="btn btn-small btn-like" onclick="toggleLike('${msg.__backendId}')">
                      ‚ù§Ô∏è Suka (${likes})
                    </button>
                    <button class="btn btn-small btn-view" onclick="viewItem('${msg.__backendId}')">
                      üëÅÔ∏è Lihat (${views})
                    </button>
                    <button class="btn btn-small btn-comment" onclick="showComments('${msg.__backendId}', 'guestbook')">
                      üí¨ Komen (${commentCount})
                    </button>
                  </div>
                  ${isAdmin ? `<button class="btn btn-delete btn-small" onclick="deleteItem('${msg.__backendId}')">Padam</button>` : ''}
                </div>
              `;
              }).join('')
            }
          </div>
        </div>
      `;
    }

    async function editProfile() {
      const profile = allData.find(d => d.type === 'profile');
      const modal = document.getElementById('genericModal');
      document.getElementById('modalTitle').textContent = 'Edit Profil';
      document.getElementById('modalBody').innerHTML = `
        <form id="profileForm">
          <div class="form-group">
            <label class="form-label" for="schoolName">Nama Sekolah/Unit</label>
            <input type="text" class="form-input" id="schoolName" value="${profile?.school_name || ''}">
          </div>
          <div class="form-group">
            <label class="form-label" for="logoUrl">URL Logo</label>
            <input type="text" class="form-input" id="logoUrl" value="${profile?.logo_url || ''}">
          </div>
          <div class="form-group">
            <label class="form-label" for="address">Alamat</label>
            <textarea class="form-textarea" id="address" rows="3">${profile?.address || ''}</textarea>
          </div>
          <div class="form-group">
            <label class="form-label" for="vision">Visi</label>
            <textarea class="form-textarea" id="vision" rows="3">${profile?.vision || ''}</textarea>
          </div>
          <div class="form-group">
            <label class="form-label" for="mission">Misi</label>
            <textarea class="form-textarea" id="mission" rows="3">${profile?.mission || ''}</textarea>
          </div>
          <div class="form-group">
            <label class="form-label" for="copyrightText">Teks Hak Cipta Footer</label>
            <input type="text" class="form-input" id="copyrightText" value="${profile?.copyright_text || '¬© 2025 Sektor Pengurusan Sekolah. Hak Cipta Terpelihara.'}" placeholder="¬© 2025 Sektor Pengurusan Sekolah">
          </div>
          <button type="submit" class="btn">Simpan</button>
          <button type="button" class="btn btn-delete" onclick="closeModal()">Batal</button>
        </form>
      `;
      modal.classList.add('active');

      document.getElementById('profileForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const profileData = {
          type: 'profile',
          school_name: document.getElementById('schoolName').value,
          logo_url: document.getElementById('logoUrl').value,
          address: document.getElementById('address').value,
          vision: document.getElementById('vision').value,
          mission: document.getElementById('mission').value,
          copyright_text: document.getElementById('copyrightText').value,
          timestamp: new Date().toISOString()
        };

        let result;
        if (profile) {
          result = await window.dataSdk.update({ ...profile, ...profileData });
        } else {
          result = await window.dataSdk.create(profileData);
        }

        if (result.isOk) {
          showToast('‚úÖ Profil berjaya dikemaskini');
          closeModal();
        } else {
          showToast('‚ùå Gagal kemaskini profil');
        }
      });
    }

    async function changePassword() {
      const modal = document.getElementById('genericModal');
      document.getElementById('modalTitle').textContent = 'Tukar Kata Laluan';
      document.getElementById('modalBody').innerHTML = `
        <form id="passwordForm">
          <div class="form-group">
            <label class="form-label" for="oldPassword">Kata Laluan Lama</label>
            <input type="password" class="form-input" id="oldPassword" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="newPassword">Kata Laluan Baru</label>
            <input type="password" class="form-input" id="newPassword" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="confirmPassword">Sahkan Kata Laluan Baru</label>
            <input type="password" class="form-input" id="confirmPassword" required>
          </div>
          <button type="submit" class="btn">Tukar</button>
          <button type="button" class="btn btn-delete" onclick="closeModal()">Batal</button>
        </form>
      `;
      modal.classList.add('active');

      document.getElementById('passwordForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const oldPassword = document.getElementById('oldPassword').value;
        const newPassword = document.getElementById('newPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;

        if (oldPassword !== currentUser.password) {
          showToast('‚ùå Kata laluan lama salah');
          return;
        }

        if (newPassword !== confirmPassword) {
          showToast('‚ùå Kata laluan baru tidak sepadan');
          return;
        }

        if (newPassword.length < 6) {
          showToast('‚ùå Kata laluan mestilah sekurang-kurangnya 6 aksara');
          return;
        }

        const userToUpdate = allData.find(d => d.type === 'user' && d.username === currentUser.username);
        if (userToUpdate) {
          const result = await window.dataSdk.update({ ...userToUpdate, password: newPassword });
          
          if (result.isOk) {
            currentUser.password = newPassword;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            showToast('‚úÖ Kata laluan berjaya ditukar');
            closeModal();
          } else {
            showToast('‚ùå Gagal tukar kata laluan');
          }
        }
      });
    }

    async function addOfficer() {
      const modal = document.getElementById('genericModal');
      document.getElementById('modalTitle').textContent = 'Tambah Pegawai';
      document.getElementById('modalBody').innerHTML = `
        <form id="officerForm">
          <div class="form-group">
            <label class="form-label" for="officerName">Nama</label>
            <input type="text" class="form-input" id="officerName" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="officerPosition">Jawatan</label>
            <input type="text" class="form-input" id="officerPosition" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="officerUnit">Unit</label>
            <select class="form-input" id="officerUnit">
              <option value="">Pilih Unit</option>
              <option value="Unit Prasekolah">Unit Prasekolah</option>
              <option value="Unit Rendah">Unit Rendah</option>
              <option value="Unit Menengah & Tingkatan Enam">Unit Menengah & Tingkatan Enam</option>
              <option value="Unit Swasta">Unit Swasta</option>
              <option value="Pentadbiran">Pentadbiran</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label" for="officerImage">URL Gambar</label>
            <input type="url" class="form-input" id="officerImage" placeholder="https://contoh.com/gambar.jpg">
          </div>
          <div class="form-group">
            <label class="form-label" for="officerEmail">Email</label>
            <input type="email" class="form-input" id="officerEmail">
          </div>
          <div class="form-group">
            <label class="form-label" for="officerPhone">Telefon</label>
            <input type="tel" class="form-input" id="officerPhone">
          </div>
          <button type="submit" class="btn">Simpan</button>
          <button type="button" class="btn btn-delete" onclick="closeModal()">Batal</button>
        </form>
      `;
      modal.classList.add('active');

      document.getElementById('officerForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const result = await window.dataSdk.create({
          type: 'officer',
          name: document.getElementById('officerName').value,
          position: document.getElementById('officerPosition').value,
          unit: document.getElementById('officerUnit').value,
          image_url: document.getElementById('officerImage').value,
          email: document.getElementById('officerEmail').value,
          phone: document.getElementById('officerPhone').value,
          timestamp: new Date().toISOString()
        });

        if (result.isOk) {
          showToast('‚úÖ Pegawai berjaya ditambah');
          closeModal();
        } else {
          showToast('‚ùå Gagal tambah pegawai');
        }
      });
    }

    async function editOfficer(id) {
      const officer = allData.find(d => d.__backendId === id);
      if (!officer) return;

      const modal = document.getElementById('genericModal');
      document.getElementById('modalTitle').textContent = 'Edit Pegawai';
      document.getElementById('modalBody').innerHTML = `
        <form id="editOfficerForm">
          <div class="form-group">
            <label class="form-label" for="editOfficerName">Nama</label>
            <input type="text" class="form-input" id="editOfficerName" value="${officer.name}" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="editOfficerPosition">Jawatan</label>
            <input type="text" class="form-input" id="editOfficerPosition" value="${officer.position}" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="editOfficerUnit">Unit</label>
            <select class="form-input" id="editOfficerUnit">
              <option value="">Pilih Unit</option>
              <option value="Unit Prasekolah" ${officer.unit === 'Unit Prasekolah' ? 'selected' : ''}>Unit Prasekolah</option>
              <option value="Unit Rendah" ${officer.unit === 'Unit Rendah' ? 'selected' : ''}>Unit Rendah</option>
              <option value="Unit Menengah & Tingkatan Enam" ${officer.unit === 'Unit Menengah & Tingkatan Enam' ? 'selected' : ''}>Unit Menengah & Tingkatan Enam</option>
              <option value="Unit Swasta" ${officer.unit === 'Unit Swasta' ? 'selected' : ''}>Unit Swasta</option>
              <option value="Pentadbiran" ${officer.unit === 'Pentadbiran' ? 'selected' : ''}>Pentadbiran</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label" for="editOfficerImage">URL Gambar</label>
            <input type="url" class="form-input" id="editOfficerImage" value="${officer.image_url || ''}" placeholder="https://contoh.com/gambar.jpg">
          </div>
          <div class="form-group">
            <label class="form-label" for="editOfficerEmail">Email</label>
            <input type="email" class="form-input" id="editOfficerEmail" value="${officer.email || ''}">
          </div>
          <div class="form-group">
            <label class="form-label" for="editOfficerPhone">Telefon</label>
            <input type="tel" class="form-input" id="editOfficerPhone" value="${officer.phone || ''}">
          </div>
          <button type="submit" class="btn">Simpan</button>
          <button type="button" class="btn btn-delete" onclick="closeModal()">Batal</button>
        </form>
      `;
      modal.classList.add('active');

      document.getElementById('editOfficerForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const result = await window.dataSdk.update({
          ...officer,
          name: document.getElementById('editOfficerName').value,
          position: document.getElementById('editOfficerPosition').value,
          unit: document.getElementById('editOfficerUnit').value,
          image_url: document.getElementById('editOfficerImage').value,
          email: document.getElementById('editOfficerEmail').value,
          phone: document.getElementById('editOfficerPhone').value
        });

        if (result.isOk) {
          showToast('‚úÖ Pegawai berjaya dikemaskini');
          closeModal();
        } else {
          showToast('‚ùå Gagal kemaskini pegawai');
        }
      });
    }

    async function addNews() {
      const modal = document.getElementById('genericModal');
      document.getElementById('modalTitle').textContent = 'Tambah Berita';
      document.getElementById('modalBody').innerHTML = `
        <form id="newsForm">
          <div class="form-group">
            <label class="form-label" for="newsTitle">Tajuk</label>
            <input type="text" class="form-input" id="newsTitle" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="newsDate">Tarikh</label>
            <input type="date" class="form-input" id="newsDate" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="newsDescription">Penerangan</label>
            <textarea class="form-textarea" id="newsDescription" rows="4" required></textarea>
          </div>
          <div class="form-group">
  <label class="form-label" for="newsImage">URL Gambar (pilihan)</label>
  <input type="url" class="form-input" id="newsImage" placeholder="https://contoh.com/gambar.jpg">
</div>
          <div class="form-group">
            <label class="form-label" for="newsLink">Link Muat Turun</label>
            <input type="url" class="form-input" id="newsLink" placeholder="https://contoh.com/lampiran.pdf">
          </div>
          <button type="submit" class="btn">Simpan</button>
          <button type="button" class="btn btn-delete" onclick="closeModal()">Batal</button>
        </form>
      `;
      modal.classList.add('active');

      document.getElementById('newsForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const result = await window.dataSdk.create({
          type: 'news',
          title: document.getElementById('newsTitle').value,
          date: document.getElementById('newsDate').value,
          description: document.getElementById('newsDescription').value,
         image_url: document.getElementById('newsImage').value,
          download_link: document.getElementById('newsLink').value,
          likes: 0,
          views: 0,
          timestamp: new Date().toISOString()
        });

        if (result.isOk) {
          showToast('‚úÖ Berita berjaya ditambah');
          closeModal();
        } else {
          showToast('‚ùå Gagal tambah berita');
        }
      });
    }

    async function editNews(id) {
      const news = allData.find(d => d.__backendId === id);
      if (!news) return;

      const modal = document.getElementById('genericModal');
      document.getElementById('modalTitle').textContent = 'Edit Berita';
      document.getElementById('modalBody').innerHTML = `
        <form id="editNewsForm">
          <div class="form-group">
            <label class="form-label" for="editNewsTitle">Tajuk</label>
            <input type="text" class="form-input" id="editNewsTitle" value="${news.title}" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="editNewsDate">Tarikh</label>
            <input type="date" class="form-input" id="editNewsDate" value="${news.date}" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="editNewsDescription">Penerangan</label>
            <textarea class="form-textarea" id="editNewsDescription" rows="4" required>${news.description}</textarea>
          </div>
          <div class="form-group">
      <label class="form-label" for="editNewsImage">URL Gambar</label>
      <input type="url" class="form-input" id="editNewsImage"
        value="${news.image_url || ''}"
        placeholder="https://i.imgur.com/gambar.jpg">
    </div>
          <div class="form-group">
            <label class="form-label" for="editNewsLink">Link Muat Turun</label>
            <input type="url" class="form-input" id="editNewsLink" value="${news.download_link || ''}" placeholder="https://contoh.com/lampiran.pdf">
          </div>
          <button type="submit" class="btn">Simpan</button>
          <button type="button" class="btn btn-delete" onclick="closeModal()">Batal</button>
        </form>
      `;
      modal.classList.add('active');

      document.getElementById('editNewsForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const result = await window.dataSdk.update({
          ...news,
          title: document.getElementById('editNewsTitle').value,
          date: document.getElementById('editNewsDate').value,
          description: document.getElementById('editNewsDescription').value,
          download_link: document.getElementById('editNewsLink').value
        });

        if (result.isOk) {
          showToast('‚úÖ Berita berjaya dikemaskini');
          closeModal();
        } else {
          showToast('‚ùå Gagal kemaskini berita');
        }
      });
    }

    async function addDocument() {
      const modal = document.getElementById('genericModal');
      document.getElementById('modalTitle').textContent = 'Tambah Dokumen';
      document.getElementById('modalBody').innerHTML = `
        <form id="documentForm">
          <div class="form-group">
            <label class="form-label" for="docTitle">Tajuk Dokumen</label>
            <input type="text" class="form-input" id="docTitle" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="docCategory">Kategori</label>
            <input type="text" class="form-input" id="docCategory">
          </div>
          <div class="form-group">
            <label class="form-label" for="docDescription">Penerangan</label>
            <textarea class="form-textarea" id="docDescription" rows="3"></textarea>
          </div>
          <div class="form-group">
            <label class="form-label" for="docLink">Link Muat Turun</label>
            <input type="url" class="form-input" id="docLink" placeholder="https://contoh.com/dokumen.pdf">
          </div>
          <button type="submit" class="btn">Simpan</button>
          <button type="button" class="btn btn-delete" onclick="closeModal()">Batal</button>
        </form>
      `;
      modal.classList.add('active');

      document.getElementById('documentForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const result = await window.dataSdk.create({
          type: 'document',
          title: document.getElementById('docTitle').value,
          category: document.getElementById('docCategory').value,
          description: document.getElementById('docDescription').value,
          download_link: document.getElementById('docLink').value,
          likes: 0,
          views: 0,
          timestamp: new Date().toISOString()
        });

        if (result.isOk) {
          showToast('‚úÖ Dokumen berjaya ditambah');
          closeModal();
        } else {
          showToast('‚ùå Gagal tambah dokumen');
        }
      });
    }

    async function editDocument(id) {
      const doc = allData.find(d => d.__backendId === id);
      if (!doc) return;

      const modal = document.getElementById('genericModal');
      document.getElementById('modalTitle').textContent = 'Edit Dokumen';
      document.getElementById('modalBody').innerHTML = `
        <form id="editDocumentForm">
          <div class="form-group">
            <label class="form-label" for="editDocTitle">Tajuk Dokumen</label>
            <input type="text" class="form-input" id="editDocTitle" value="${doc.title}" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="editDocCategory">Kategori</label>
            <input type="text" class="form-input" id="editDocCategory" value="${doc.category || ''}">
          </div>
          <div class="form-group">
            <label class="form-label" for="editDocDescription">Penerangan</label>
            <textarea class="form-textarea" id="editDocDescription" rows="3">${doc.description || ''}</textarea>
          </div>
          <div class="form-group">
            <label class="form-label" for="editDocLink">Link Muat Turun</label>
            <input type="url" class="form-input" id="editDocLink" value="${doc.download_link || ''}" placeholder="https://contoh.com/dokumen.pdf">
          </div>
          <button type="submit" class="btn">Simpan</button>
          <button type="button" class="btn btn-delete" onclick="closeModal()">Batal</button>
        </form>
      `;
      modal.classList.add('active');

      document.getElementById('editDocumentForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const result = await window.dataSdk.update({
          ...doc,
          title: document.getElementById('editDocTitle').value,
          category: document.getElementById('editDocCategory').value,
          description: document.getElementById('editDocDescription').value,
          download_link: document.getElementById('editDocLink').value
        });

        if (result.isOk) {
          showToast('‚úÖ Dokumen berjaya dikemaskini');
          closeModal();
        } else {
          showToast('‚ùå Gagal kemaskini dokumen');
        }
      });
    }

    async function addGuestbookEntry() {
      const modal = document.getElementById('genericModal');
      document.getElementById('modalTitle').textContent = 'Tulis Mesej';
      document.getElementById('modalBody').innerHTML = `
        <form id="guestbookForm">
          <div class="form-group">
            <label class="form-label" for="visitorName">Nama Anda</label>
            <input type="text" class="form-input" id="visitorName" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="visitorMessage">Mesej</label>
            <textarea class="form-textarea" id="visitorMessage" rows="4" required></textarea>
          </div>
          <button type="submit" class="btn">Hantar</button>
          <button type="button" class="btn btn-delete" onclick="closeModal()">Batal</button>
        </form>
      `;
      modal.classList.add('active');

      document.getElementById('guestbookForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const now = new Date();
        const dateStr = now.toLocaleDateString('ms-MY', { day: '2-digit', month: 'short', year: 'numeric' });
        
        const result = await window.dataSdk.create({
          type: 'guestbook',
          visitor_name: document.getElementById('visitorName').value,
          message: document.getElementById('visitorMessage').value,
          date: dateStr,
          likes: 0,
          views: 0,
          timestamp: now.toISOString()
        });

        if (result.isOk) {
          showToast('‚úÖ Mesej berjaya dihantar');
          closeModal();
        } else {
          showToast('‚ùå Gagal hantar mesej');
        }
      });
    }

    async function deleteItem(id) {
      const item = allData.find(d => d.__backendId === id);
      if (!item) return;
      
      const modal = document.getElementById('genericModal');
      document.getElementById('modalTitle').textContent = 'Sahkan Padam';
      document.getElementById('modalBody').innerHTML = `
        <p style="margin-bottom: 2rem; color: #666;">Adakah anda pasti mahu memadam item ini?</p>
        <button class="btn btn-delete" onclick="confirmDelete('${id}')">Ya, Padam</button>
        <button class="btn" onclick="closeModal()">Batal</button>
      `;
      modal.classList.add('active');
    }

    async function confirmDelete(id) {
      const item = allData.find(d => d.__backendId === id);
      if (!item) return;

      const result = await window.dataSdk.delete(item);
      if (result.isOk) {
        showToast('‚úÖ Berjaya dipadam');
        closeModal();
      } else {
        showToast('‚ùå Gagal padam');
      }
    }

    function renderPerkongsian() {
      const content = document.getElementById('contentArea');
      const perkongsian = allData.filter(d => d.type === 'sharing');
      
      content.innerHTML = `
        <div class="card">
          <h2 class="card-title">ü§ù Perkongsian</h2>
          ${isAdmin ? '<button class="btn" onclick="addSharing()">+ Tambah Perkongsian</button>' : ''}
          
          <div class="grid">
            ${perkongsian.length === 0 ? 
              '<p style="grid-column: 1/-1; text-align: center; color: #999; padding: 2rem;">Tiada perkongsian tersedia</p>' :
              perkongsian.map(item => {
                const likes = item.likes || 0;
                const views = item.views || 0;
                const commentCount = allData.filter(d => d.type === 'interaction' && d.parent_id === item.__backendId && d.interaction_type === 'comment').length;
                
                return `
                <div class="grid-item">
                  <h3 style="color: #007bff; margin-bottom: 0.8rem; font-size: 1.2rem;">${item.title}</h3>
                  <p style="line-height: 1.6; color: #666; margin-bottom: 0.8rem;">${item.description || ''}</p>
                  <p style="font-size: 0.85rem; color: #999; margin-bottom: 0.5rem;">üìÖ ${item.date || ''}</p>
                  <p style="font-size: 0.85rem; color: #999;">üë§ ${item.author || ''}</p>
                  ${item.download_link ? `<p style="font-size: 0.9rem; color: #28a745; margin-top: 0.5rem;">üîó <a href="${item.download_link}" target="_blank" rel="noopener noreferrer" style="color: #28a745; text-decoration: underline;">Muat Turun</a></p>` : ''}
                  
                  <div class="interaction-buttons">
                    <button class="btn btn-small btn-like" onclick="toggleLike('${item.__backendId}')">
                      ‚ù§Ô∏è Suka (${likes})
                    </button>
                    <button class="btn btn-small btn-view" onclick="viewItem('${item.__backendId}')">
                      üëÅÔ∏è Lihat (${views})
                    </button>
                    <button class="btn btn-small btn-comment" onclick="showComments('${item.__backendId}', 'sharing')">
                      üí¨ Komen (${commentCount})
                    </button>
                  </div>
                  ${isAdmin ? `
                    <div style="margin-top: 0.5rem;">
                      <button class="btn btn-small" onclick="editSharing('${item.__backendId}')">‚úèÔ∏è Edit</button>
                      <button class="btn btn-delete btn-small" onclick="deleteItem('${item.__backendId}')">Padam</button>
                    </div>
                  ` : ''}
                </div>
              `;
              }).join('')
            }
          </div>
        </div>
      `;
    }
function renderPertukaranMenengah() {
  const content = document.getElementById('contentArea');

  const data = allData.filter(d => d.type === 'pertukaran_menengah');

  const jumlahPermohonan = data.length;
  const diluluskan = data.filter(d => d.status === 'Diluluskan').length;
  const ditolak = data.filter(d => d.status === 'Ditolak').length;
  const dalamProses = data.filter(d => d.status === 'Dalam Proses').length;

  content.innerHTML = `
    <div class="card">
      <h2 class="card-title">üîÑ Dashboard Pertukaran Murid Menengah</h2>

      ${isAdmin ? `<button class="btn" onclick="addPertukaranMenengah()">+ Permohonan Baharu</button>` : ''}

      <div class="grid" style="margin-top:1.5rem">
        <div class="grid-item" style="border-left:4px solid #007bff;text-align:center">
          <h3>${jumlahPermohonan}</h3>
          <p>Jumlah Permohonan</p>
        </div>

        <div class="grid-item" style="border-left:4px solid #28a745;text-align:center">
          <h3>${diluluskan}</h3>
          <p>Diluluskan</p>
        </div>

        <div class="grid-item" style="border-left:4px solid #ffc107;text-align:center">
          <h3>${dalamProses}</h3>
          <p>Dalam Proses</p>
        </div>

        <div class="grid-item" style="border-left:4px solid #dc3545;text-align:center">
          <h3>${ditolak}</h3>
          <p>Ditolak</p>
        </div>
      </div>
    </div>

    <div class="card">
      <h2 class="card-title">üìÑ Senarai Permohonan</h2>

      ${data.length === 0
        ? `<p style="text-align:center;color:#999">Tiada permohonan direkodkan</p>`
        : data.map(item => `
          <div class="grid-item" style="margin-bottom:1rem">
            <strong>üë§ ${item.nama_murid}</strong><br>
            üéì Tingkatan: <strong>${item.tingkatan}</strong><br>
            üè´ ${item.sekolah_asal} ‚ûú ${item.sekolah_baharu}<br>
            üìÖ ${item.tarikh}<br>
            üìå Status: <strong>${item.status}</strong>

            ${isAdmin ? `
              <div style="margin-top:0.5rem">
                <button class="btn btn-small" onclick="editPertukaranMenengah('${item.__backendId}')">‚úèÔ∏è Edit</button>
                <button class="btn btn-delete btn-small" onclick="deleteItem('${item.__backendId}')">Padam</button>
              </div>
            ` : ''}
          </div>
        `).join('')
      }
    </div>
  `;
}
   async function addPertukaranMenengah() {
  const modal = document.getElementById('genericModal');
  document.getElementById('modalTitle').textContent =
    'Permohonan Pertukaran Murid Menengah';

  // 1Ô∏è‚É£ Masukkan HTML borang DAHULU
  document.getElementById('modalBody').innerHTML = `
    <form id="pertukaranForm">
      <div class="form-group">
        <label class="form-label">Nama Murid</label>
        <input class="form-input" id="namaMurid" required>
      </div>
      <div class="form-group">
  <label class="form-label">Tingkatan</label>
  <select class="form-input" id="tingkatan" required>
    <option value="">-- Pilih Tingkatan --</option>
    <option>Tingkatan 1</option>
    <option>Tingkatan 2</option>
    <option>Tingkatan 3</option>
    <option>Tingkatan 4</option>
    <option>Tingkatan 5</option>
    <option>Tingkatan 6</option>
  </select>
</div>
      <div class="form-group">
        <label class="form-label">Sekolah Asal</label>
        <input class="form-input" id="sekolahAsal" required>
      </div>

      <div class="form-group">
        <label class="form-label">Sekolah Baharu</label>
        <input class="form-input" id="sekolahBaharu" required>
      </div>

      <button class="btn" type="submit">Simpan</button>
      <button class="btn btn-delete" type="button" onclick="closeModal()">Batal</button>
    </form>
  `;

  modal.classList.add('active');

  // 2Ô∏è‚É£ BARU daftar event submit
  document
    .getElementById('pertukaranForm')
    .addEventListener('submit', async (e) => {
      e.preventDefault();

      // 3Ô∏è‚É£ Ambil elemen dengan betul
      const namaMurid = document.getElementById('namaMurid');
      const sekolahAsal = document.getElementById('sekolahAsal');
      const sekolahBaharu = document.getElementById('sekolahBaharu');

      if (!namaMurid.value || !sekolahAsal.value || !sekolahBaharu.value) {
        alert('Sila lengkapkan semua maklumat');
        return;
      }

      // 4Ô∏è‚É£ Simpan ke Firebase
      const result = await window.dataSdk.create({
        type: 'pertukaran_menengah',
        nama_murid: namaMurid.value.trim(),
        tingkatan: document.getElementById('tingkatan').value,
        sekolah_asal: sekolahAsal.value.trim(),
        sekolah_baharu: sekolahBaharu.value.trim(),
        status: 'Dalam Proses',
        tarikh: new Date().toLocaleDateString('ms-MY'),

        // üî• WAJIB untuk Firestore (orderBy)
        createdAt: new Date()
      });

      if (result.isOk) {
        showToast('‚úÖ Permohonan berjaya direkodkan');
        document.getElementById('pertukaranForm').reset();
        closeModal();
      } else {
        showToast('‚ùå Gagal simpan permohonan');
      }
    });
}
async function editPertukaranMenengah(id) {
  const item = allData.find(d => d.__backendId === id);

  if (!item) {
    alert('Rekod tidak dijumpai');
    return;
  }

  const modal = document.getElementById('genericModal');
  document.getElementById('modalTitle').textContent =
    'Edit Permohonan Pertukaran Murid Menengah';

  document.getElementById('modalBody').innerHTML = `
    <form id="editPertukaranForm">
      <div class="form-group">
        <label class="form-label">Nama Murid</label>
        <input class="form-input" id="editNamaMurid" value="${item.nama_murid}" required>
      </div>

      <div class="form-group">
        <label class="form-label">Sekolah Asal</label>
        <input class="form-input" id="editSekolahAsal" value="${item.sekolah_asal}" required>
      </div>

      <div class="form-group">
        <label class="form-label">Sekolah Baharu</label>
        <input class="form-input" id="editSekolahBaharu" value="${item.sekolah_baharu}" required>
      </div>

      <div class="form-group">
        <label class="form-label">Status</label>
        <select class="form-input" id="editStatus">
          <option ${item.status === 'Dalam Proses' ? 'selected' : ''}>Dalam Proses</option>
          <option ${item.status === 'Diluluskan' ? 'selected' : ''}>Diluluskan</option>
          <option ${item.status === 'Ditolak' ? 'selected' : ''}>Ditolak</option>
        </select>
      </div>

      <button class="btn" type="submit">Simpan</button>
      <button class="btn btn-delete" type="button" onclick="closeModal()">Batal</button>
    </form>
  `;

  modal.classList.add('active');

  document
    .getElementById('editPertukaranForm')
    .addEventListener('submit', async (e) => {
      e.preventDefault();

      const result = await window.dataSdk.update({
        __backendId: id,
        nama_murid: document.getElementById('editNamaMurid').value.trim(),
       tingkatan: document.getElementById('tingkatan').value,
        sekolah_asal: document.getElementById('editSekolahAsal').value.trim(),
        sekolah_baharu: document.getElementById('editSekolahBaharu').value.trim(),
        status: document.getElementById('editStatus').value,
        updatedAt: new Date()
      });

      if (result.isOk) {
        showToast('‚úÖ Permohonan berjaya dikemaskini');
        closeModal();
      } else {
        showToast('‚ùå Gagal kemaskini permohonan');
      }
    });
}
function renderPertukaranRendah() {
  const content = document.getElementById('contentArea');

  const data = allData.filter(d => d.type === 'pertukaran_rendah');

  const jumlahPermohonan = data.length;
  const diluluskan = data.filter(d => d.status === 'Diluluskan').length;
  const ditolak = data.filter(d => d.status === 'Ditolak').length;
  const dalamProses = data.filter(d => d.status === 'Dalam Proses').length;

  content.innerHTML = `
    <div class="card">
      <h2 class="card-title">üîÑ Dashboard Pertukaran Murid Rendah</h2>

      ${isAdmin ? `<button class="btn" onclick="addPertukaranRendah()">+ Permohonan Baharu</button>` : ''}

      <div class="grid" style="margin-top:1.5rem">
        <div class="grid-item" style="border-left:4px solid #007bff;text-align:center">
          <h3>${jumlahPermohonan}</h3>
          <p>Jumlah Permohonan</p>
        </div>

        <div class="grid-item" style="border-left:4px solid #28a745;text-align:center">
          <h3>${diluluskan}</h3>
          <p>Diluluskan</p>
        </div>

        <div class="grid-item" style="border-left:4px solid #ffc107;text-align:center">
          <h3>${dalamProses}</h3>
          <p>Dalam Proses</p>
        </div>

        <div class="grid-item" style="border-left:4px solid #dc3545;text-align:center">
          <h3>${ditolak}</h3>
          <p>Ditolak</p>
        </div>
      </div>
    </div>

    <div class="card">
      <h2 class="card-title">üìÑ Senarai Permohonan</h2>

      ${data.length === 0
        ? `<p style="text-align:center;color:#999">Tiada permohonan direkodkan</p>`
        : data.map(item => `
          <div class="grid-item" style="margin-bottom:1rem">
            <strong>üë§ ${item.nama_murid}</strong><br>
            üéì Tahun: <strong>${item.tingkatan}</strong><br>
            üè´ ${item.sekolah_asal} ‚ûú ${item.sekolah_baharu}<br>
            üìÖ ${item.tarikh}<br>
            üìå Status: <strong>${item.status}</strong>

            ${isAdmin ? `
              <div style="margin-top:0.5rem">
                <button class="btn btn-small" onclick="editPertukaranRendah('${item.__backendId}')">‚úèÔ∏è Edit</button>
                <button class="btn btn-delete btn-small" onclick="deleteItem('${item.__backendId}')">Padam</button>
              </div>
            ` : ''}
          </div>
        `).join('')
      }
    </div>
  `;
}
   async function addPertukaranRendah() {
  const modal = document.getElementById('genericModal');
  document.getElementById('modalTitle').textContent =
    'Permohonan Pertukaran Murid Rendah';

  // 1Ô∏è‚É£ Masukkan HTML borang DAHULU
  document.getElementById('modalBody').innerHTML = `
    <form id="pertukaranForm">
      <div class="form-group">
        <label class="form-label">Nama Murid</label>
        <input class="form-input" id="namaMurid" required>
      </div>
      <div class="form-group">
  <label class="form-label">Tahun</label>
  <select class="form-input" id="tahun" required>
    <option value="">-- Pilih Tahun --</option>
    <option>Tahun 1</option>
    <option>Tahun 2</option>
    <option>Tahun 3</option>
    <option>Tahun 4</option>
    <option>Tahun 5</option>
    <option>Tahun 6</option>
  </select>
</div>
      <div class="form-group">
        <label class="form-label">Sekolah Asal</label>
        <input class="form-input" id="sekolahAsal" required>
      </div>

      <div class="form-group">
        <label class="form-label">Sekolah Baharu</label>
        <input class="form-input" id="sekolahBaharu" required>
      </div>

      <button class="btn" type="submit">Simpan</button>
      <button class="btn btn-delete" type="button" onclick="closeModal()">Batal</button>
    </form>
  `;

  modal.classList.add('active');

  // 2Ô∏è‚É£ BARU daftar event submit
  document
    .getElementById('pertukaranForm')
    .addEventListener('submit', async (e) => {
      e.preventDefault();

      // 3Ô∏è‚É£ Ambil elemen dengan betul
      const namaMurid = document.getElementById('namaMurid');
      const sekolahAsal = document.getElementById('sekolahAsal');
      const sekolahBaharu = document.getElementById('sekolahBaharu');

      if (!namaMurid.value || !sekolahAsal.value || !sekolahBaharu.value) {
        alert('Sila lengkapkan semua maklumat');
        return;
      }

      // 4Ô∏è‚É£ Simpan ke Firebase
      const result = await window.dataSdk.create({
        type: 'pertukaran_rendah',
        nama_murid: namaMurid.value.trim(),
        tingkatan: document.getElementById('tahun').value,
        sekolah_asal: sekolahAsal.value.trim(),
        sekolah_baharu: sekolahBaharu.value.trim(),
        status: 'Dalam Proses',
        tarikh: new Date().toLocaleDateString('ms-MY'),

        // üî• WAJIB untuk Firestore (orderBy)
        createdAt: new Date()
      });

      if (result.isOk) {
        showToast('‚úÖ Permohonan berjaya direkodkan');
        document.getElementById('pertukaranForm').reset();
        closeModal();
      } else {
        showToast('‚ùå Gagal simpan permohonan');
      }
    });
}
async function editPertukaranRendah(id) {
  const item = allData.find(d => d.__backendId === id);

  if (!item) {
    alert('Rekod tidak dijumpai');
    return;
  }

  const modal = document.getElementById('genericModal');
  document.getElementById('modalTitle').textContent =
    'Edit Permohonan Pertukaran Murid Rendah';

  document.getElementById('modalBody').innerHTML = `
    <form id="editPertukaranForm">
      <div class="form-group">
        <label class="form-label">Nama Murid</label>
        <input class="form-input" id="editNamaMurid" value="${item.nama_murid}" required>
      </div>

      <div class="form-group">
        <label class="form-label">Sekolah Asal</label>
        <input class="form-input" id="editSekolahAsal" value="${item.sekolah_asal}" required>
      </div>

      <div class="form-group">
        <label class="form-label">Sekolah Baharu</label>
        <input class="form-input" id="editSekolahBaharu" value="${item.sekolah_baharu}" required>
      </div>

      <div class="form-group">
        <label class="form-label">Status</label>
        <select class="form-input" id="editStatus">
          <option ${item.status === 'Dalam Proses' ? 'selected' : ''}>Dalam Proses</option>
          <option ${item.status === 'Diluluskan' ? 'selected' : ''}>Diluluskan</option>
          <option ${item.status === 'Ditolak' ? 'selected' : ''}>Ditolak</option>
        </select>
      </div>

      <button class="btn" type="submit">Simpan</button>
      <button class="btn btn-delete" type="button" onclick="closeModal()">Batal</button>
    </form>
  `;

  modal.classList.add('active');

  document
    .getElementById('editPertukaranForm')
    .addEventListener('submit', async (e) => {
      e.preventDefault();

      const result = await window.dataSdk.update({
        __backendId: id,
        nama_murid: document.getElementById('editNamaMurid').value.trim(),
       tingkatan: document.getElementById('tingkatan').value,
        sekolah_asal: document.getElementById('editSekolahAsal').value.trim(),
        sekolah_baharu: document.getElementById('editSekolahBaharu').value.trim(),
        status: document.getElementById('editStatus').value,
        updatedAt: new Date()
      });

      if (result.isOk) {
        showToast('‚úÖ Permohonan berjaya dikemaskini');
        closeModal();
      } else {
        showToast('‚ùå Gagal kemaskini permohonan');
      }
    });
}
    function renderStatistik() {
      const content = document.getElementById('contentArea');
      
      const totalOfficers = allData.filter(d => d.type === 'officer').length;
      const totalNews = allData.filter(d => d.type === 'news').length;
      const totalDocuments = allData.filter(d => d.type === 'document').length;
      const totalGuestbook = allData.filter(d => d.type === 'guestbook').length;
      const totalSharing = allData.filter(d => d.type === 'sharing').length;
      const totalCircular = allData.filter(d => d.type === 'circular').length;
      const totalComments = allData.filter(d => d.type === 'interaction' && d.interaction_type === 'comment').length;
      
      const schoolStats = allData.find(d => d.type === 'school_stats');
      
      content.innerHTML = `
        <div class="card">
          <h2 class="card-title">üìä Data Sekolah & Pendidikan</h2>
          ${isAdmin ? '<button class="btn" onclick="editSchoolStats()">‚úèÔ∏è Edit Data Sekolah</button>' : ''}
          
          <div class="grid">
            <div class="grid-item" style="background: linear-gradient(135deg, rgba(0, 123, 255, 0.1) 0%, rgba(0, 191, 255, 0.05) 100%); border-left: 4px solid #007bff; text-align: center;">
              <div style="font-size: 3rem; margin-bottom: 1rem;">üè´</div>
              <h3 style="font-size: 2.5rem; font-weight: 700; color: #007bff; margin-bottom: 0.5rem;">${schoolStats?.sekolah_rendah || 33}</h3>
              <p style="color: #666; font-weight: 600;">Sekolah Rendah</p>
            </div>
            
            <div class="grid-item" style="background: linear-gradient(135deg, rgba(0, 191, 255, 0.1) 0%, rgba(0, 123, 255, 0.05) 100%); border-left: 4px solid #00bfff; text-align: center;">
              <div style="font-size: 3rem; margin-bottom: 1rem;">üéì</div>
              <h3 style="font-size: 2.5rem; font-weight: 700; color: #00bfff; margin-bottom: 0.5rem;">${schoolStats?.sekolah_menengah || 7}</h3>
              <p style="color: #666; font-weight: 600;">Sekolah Menengah</p>
            </div>
            
            <div class="grid-item" style="background: linear-gradient(135deg, rgba(0, 123, 255, 0.1) 0%, rgba(0, 191, 255, 0.05) 100%); border-left: 4px solid #007bff; text-align: center;">
              <div style="font-size: 3rem; margin-bottom: 1rem;">üìò</div>
              <h3 style="font-size: 2.5rem; font-weight: 700; color: #007bff; margin-bottom: 0.5rem;">${schoolStats?.sekolah_k9 || 1}</h3>
              <p style="color: #666; font-weight: 600;">Sekolah K9</p>
            </div>
            
            <div class="grid-item" style="background: linear-gradient(135deg, rgba(0, 191, 255, 0.1) 0%, rgba(0, 123, 255, 0.05) 100%); border-left: 4px solid #00bfff; text-align: center;">
              <div style="font-size: 3rem; margin-bottom: 1rem;">üë∂</div>
              <h3 style="font-size: 2.5rem; font-weight: 700; color: #00bfff; margin-bottom: 0.5rem;">${schoolStats?.prasekolah || 12}</h3>
              <p style="color: #666; font-weight: 600;">Prasekolah</p>
            </div>
            <div class="grid-item" style="background: linear-gradient(135deg, rgba(255, 99, 132, 0.1) 0%, rgba(255, 159, 159, 0.05) 100%); border-left: 4px solid #ff6384; text-align: center;">
  <div style="font-size: 3rem; margin-bottom: 1rem;">üßí</div>
  <h3 style="font-size: 2.5rem; font-weight: 700; color: #ff6384; margin-bottom: 0.5rem;">
    ${schoolStats?.prasekolah_swasta || 3}
  </h3>
  <p style="color: #666; font-weight: 600;">Prasekolah Swasta</p>
</div>

            
           <div class="grid-item" style="background: linear-gradient(135deg, rgba(255, 193, 7, 0.1) 0%, rgba(255, 219, 77, 0.05) 100%); border-left: 4px solid #ffc107; text-align: center;">
  <div style="font-size: 3rem; margin-bottom: 1rem;">üè´</div>
  <h3 style="font-size: 2.5rem; font-weight: 700; color: #ffc107; margin-bottom: 0.5rem;">
    ${schoolStats?.sekolah_swasta_rendah || 2}
  </h3>
  <p style="color: #666; font-weight: 600;">Sekolah Swasta Rendah</p>
</div>
<div class="grid-item" style="background: linear-gradient(135deg, rgba(40, 167, 69, 0.1) 0%, rgba(72, 199, 116, 0.05) 100%); border-left: 4px solid #28a745; text-align: center;">
  <div style="font-size: 3rem; margin-bottom: 1rem;">üéì</div>
  <h3 style="font-size: 2.5rem; font-weight: 700; color: #28a745; margin-bottom: 0.5rem;">
    ${schoolStats?.sekolah_swasta_menengah || 1}
  </h3>
  <p style="color: #666; font-weight: 600;">Sekolah Swasta Menengah</p>
</div>

            
            <div class="grid-item" style="background: linear-gradient(135deg, rgba(0, 191, 255, 0.1) 0%, rgba(0, 123, 255, 0.05) 100%); border-left: 4px solid #00bfff; text-align: center;">
              <div style="font-size: 3rem; margin-bottom: 1rem;">üìö</div>
              <h3 style="font-size: 2.5rem; font-weight: 700; color: #00bfff; margin-bottom: 0.5rem;">${schoolStats?.tingkatan_enam || 4}</h3>
              <p style="color: #666; font-weight: 600;">Pusat Tingkatan Enam</p>
            </div>
            
            <div class="grid-item" style="background: linear-gradient(135deg, rgba(0, 123, 255, 0.1) 0%, rgba(0, 191, 255, 0.05) 100%); border-left: 4px solid #007bff; text-align: center;">
              <div style="font-size: 3rem; margin-bottom: 1rem;">üè´</div>
              <h3 style="font-size: 2.5rem; font-weight: 700; color: #007bff; margin-bottom: 0.5rem;">${schoolStats?.ppki_menengah || 2}</h3>
              <p style="color: #666; font-weight: 600;">PPKI Menengah</p>
            </div>
            
            <div class="grid-item" style="background: linear-gradient(135deg, rgba(0, 191, 255, 0.1) 0%, rgba(0, 123, 255, 0.05) 100%); border-left: 4px solid #00bfff; text-align: center;">
              <div style="font-size: 3rem; margin-bottom: 1rem;">üéí</div>
              <h3 style="font-size: 2.5rem; font-weight: 700; color: #00bfff; margin-bottom: 0.5rem;">${schoolStats?.ppki_rendah || 5}</h3>
              <p style="color: #666; font-weight: 600;">PPKI Rendah</p>
            </div>
            
            <div class="grid-item" style="background: linear-gradient(135deg, rgba(40, 167, 69, 0.1) 0%, rgba(72, 199, 116, 0.05) 100%); border-left: 4px solid #28a745; text-align: center;">
              <div style="font-size: 3rem; margin-bottom: 1rem;">üë®‚Äçüéì</div>
              <h3 style="font-size: 2.5rem; font-weight: 700; color: #28a745; margin-bottom: 0.5rem;">${schoolStats?.jumlah_murid?.toLocaleString() || '18,395'}</h3>
              <p style="color: #666; font-weight: 600;">Jumlah Murid</p>
            </div>
            
            <div class="grid-item" style="background: linear-gradient(135deg, rgba(255, 193, 7, 0.1) 0%, rgba(255, 219, 77, 0.05) 100%); border-left: 4px solid #ffc107; text-align: center;">
              <div style="font-size: 3rem; margin-bottom: 1rem;">üë®</div>
              <h3 style="font-size: 2.5rem; font-weight: 700; color: #ffc107; margin-bottom: 0.5rem;">${schoolStats?.jumlah_guru || 625}</h3>
              <p style="color: #666; font-weight: 600;">Jumlah Guru</p>
            </div>
          </div>
        </div>

        <div class="card">
          <h2 class="card-title">üìä Statistik Portal</h2>
          
          <div class="grid">
            <div class="grid-item" style="background: linear-gradient(135deg, rgba(0, 123, 255, 0.1) 0%, rgba(0, 191, 255, 0.05) 100%); border-left: 4px solid #007bff;">
              <div style="font-size: 3rem; margin-bottom: 1rem;">üë•</div>
              <h3 style="font-size: 2.5rem; font-weight: 700; color: #007bff; margin-bottom: 0.5rem;">${totalOfficers}</h3>
              <p style="color: #666; font-weight: 600;">Jumlah Pegawai</p>
            </div>
            
            <div class="grid-item" style="background: linear-gradient(135deg, rgba(0, 191, 255, 0.1) 0%, rgba(0, 123, 255, 0.05) 100%); border-left: 4px solid #00bfff;">
              <div style="font-size: 3rem; margin-bottom: 1rem;">üì∞</div>
              <h3 style="font-size: 2.5rem; font-weight: 700; color: #00bfff; margin-bottom: 0.5rem;">${totalNews}</h3>
              <p style="color: #666; font-weight: 600;">Berita & Aktiviti</p>
            </div>
            
            <div class="grid-item" style="background: linear-gradient(135deg, rgba(0, 123, 255, 0.1) 0%, rgba(0, 191, 255, 0.05) 100%); border-left: 4px solid #007bff;">
              <div style="font-size: 3rem; margin-bottom: 1rem;">üìÅ</div>
              <h3 style="font-size: 2.5rem; font-weight: 700; color: #007bff; margin-bottom: 0.5rem;">${totalDocuments}</h3>
              <p style="color: #666; font-weight: 600;">Dokumen & Borang</p>
            </div>
            
            <div class="grid-item" style="background: linear-gradient(135deg, rgba(0, 191, 255, 0.1) 0%, rgba(0, 123, 255, 0.05) 100%); border-left: 4px solid #00bfff;">
              <div style="font-size: 3rem; margin-bottom: 1rem;">üìñ</div>
              <h3 style="font-size: 2.5rem; font-weight: 700; color: #00bfff; margin-bottom: 0.5rem;">${totalGuestbook}</h3>
              <p style="color: #666; font-weight: 600;">Mesej Pelawat</p>
            </div>
            
            <div class="grid-item" style="background: linear-gradient(135deg, rgba(0, 123, 255, 0.1) 0%, rgba(0, 191, 255, 0.05) 100%); border-left: 4px solid #007bff;">
              <div style="font-size: 3rem; margin-bottom: 1rem;">ü§ù</div>
              <h3 style="font-size: 2.5rem; font-weight: 700; color: #007bff; margin-bottom: 0.5rem;">${totalSharing}</h3>
              <p style="color: #666; font-weight: 600;">Perkongsian</p>
            </div>
            
            <div class="grid-item" style="background: linear-gradient(135deg, rgba(0, 191, 255, 0.1) 0%, rgba(0, 123, 255, 0.05) 100%); border-left: 4px solid #00bfff;">
              <div style="font-size: 3rem; margin-bottom: 1rem;">üìã</div>
              <h3 style="font-size: 2.5rem; font-weight: 700; color: #00bfff; margin-bottom: 0.5rem;">${totalCircular}</h3>
              <p style="color: #666; font-weight: 600;">Pekeliling</p>
            </div>
            
            <div class="grid-item" style="background: linear-gradient(135deg, rgba(255, 193, 7, 0.1) 0%, rgba(255, 219, 77, 0.05) 100%); border-left: 4px solid #ffc107;">
              <div style="font-size: 3rem; margin-bottom: 1rem;">üí¨</div>
              <h3 style="font-size: 2.5rem; font-weight: 700; color: #ffc107; margin-bottom: 0.5rem;">${totalComments}</h3>
              <p style="color: #666; font-weight: 600;">Jumlah Komen</p>
            </div>
            
            <div class="grid-item" style="background: linear-gradient(135deg, rgba(40, 167, 69, 0.1) 0%, rgba(72, 199, 116, 0.05) 100%); border-left: 4px solid #28a745;">
              <div style="font-size: 3rem; margin-bottom: 1rem;">üìà</div>
              <h3 style="font-size: 2.5rem; font-weight: 700; color: #28a745; margin-bottom: 0.5rem;">${totalOfficers + totalNews + totalDocuments + totalGuestbook + totalSharing + totalCircular}</h3>
              <p style="color: #666; font-weight: 600;">Jumlah Keseluruhan</p>
            </div>
          </div>
        </div>

        <div class="card">
          <h2 class="card-title">üìÖ Aktiviti Terkini</h2>
          <div style="display: flex; flex-direction: column; gap: 1rem;">
            ${(() => {
              const activities = [];
              
              // Collect all activities with timestamps
              allData.forEach(item => {
                if (item.timestamp && (item.type === 'guestbook' || item.type === 'sharing' || item.type === 'news' || item.type === 'document' || item.type === 'circular')) {
                  let icon = 'üìÑ';
                  let typeLabel = 'Item';
                  
                  if (item.type === 'guestbook') {
                    icon = 'üìñ';
                    typeLabel = 'Buku Pelawat';
                  } else if (item.type === 'sharing') {
                    icon = 'ü§ù';
                    typeLabel = 'Perkongsian';
                  } else if (item.type === 'news') {
                    icon = 'üì∞';
                    typeLabel = 'Berita';
                  } else if (item.type === 'document') {
                    icon = 'üìë';
                    typeLabel = 'Dokumen';
                  } else if (item.type === 'circular') {
                    icon = 'üìã';
                    typeLabel = 'Pekeliling';
                  }
                  
                  activities.push({
                    icon,
                    typeLabel,
                    title: item.title || item.message || item.visitor_name || 'Tanpa tajuk',
                    timestamp: new Date(item.timestamp),
                    date: item.date || new Date(item.timestamp).toLocaleDateString('ms-MY')
                  });
                }
              });
              
              // Sort by timestamp (newest first)
              activities.sort((a, b) => b.timestamp - a.timestamp);
              
              // Take only the latest 10 activities
              const latestActivities = activities.slice(0, 10);
              
              if (latestActivities.length === 0) {
                return '<div style="background: rgba(255, 255, 255, 0.9); padding: 1.5rem; border-radius: 15px; border-left: 4px solid #007bff; text-align: center; color: #999;">Tiada aktiviti terkini</div>';
              }
              
              return latestActivities.map(activity => {
                const now = new Date();
                const diffMs = now - activity.timestamp;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMs / 3600000);
                const diffDays = Math.floor(diffMs / 86400000);
                
                let timeAgo = '';
                if (diffMins < 1) {
                  timeAgo = 'Baru sahaja';
                } else if (diffMins < 60) {
                  timeAgo = `${diffMins} minit lalu`;
                } else if (diffHours < 24) {
                  timeAgo = `${diffHours} jam lalu`;
                } else if (diffDays === 1) {
                  timeAgo = 'Semalam';
                } else {
                  timeAgo = `${diffDays} hari lalu`;
                }
                
                return `
                  <div style="background: rgba(255, 255, 255, 0.9); padding: 1.2rem; border-radius: 12px; border-left: 4px solid #007bff; display: flex; align-items: center; gap: 1rem; transition: all 0.3s ease;">
                    <div style="font-size: 2rem; min-width: 40px; text-align: center;">${activity.icon}</div>
                    <div style="flex: 1;">
                      <h4 style="color: #007bff; font-weight: 600; margin-bottom: 0.3rem; font-size: 1rem;">${activity.title}</h4>
                      <p style="color: #666; font-size: 0.85rem; margin-bottom: 0.2rem;">${activity.typeLabel}</p>
                      <div style="display: flex; gap: 1rem; font-size: 0.8rem; color: #999;">
                        <span>üïê ${timeAgo}</span>
                        <span>üìÖ ${activity.date}</span>
                      </div>
                    </div>
                  </div>
                `;
              }).join('');
            })()}
          </div>
        </div>
      `;
    }

    async function editSchoolStats() {
      const stats = allData.find(d => d.type === 'school_stats');
      const modal = document.getElementById('genericModal');
      document.getElementById('modalTitle').textContent = 'Edit Data Sekolah & Pendidikan';
      document.getElementById('modalBody').innerHTML = `
        <form id="statsForm">
          <div class="form-group">
            <label class="form-label" for="sekolahRendah">Sekolah Rendah</label>
            <input type="number" class="form-input" id="sekolahRendah" value="${stats?.sekolah_rendah || 33}" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="sekolahMenengah">Sekolah Menengah</label>
            <input type="number" class="form-input" id="sekolahMenengah" value="${stats?.sekolah_menengah || 7}" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="sekolahK9">Sekolah K9</label>
            <input type="number" class="form-input" id="sekolahK9" value="${stats?.sekolah_k9 || 1}" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="prasekolah">Prasekolah</label>
            <input type="number" class="form-input" id="prasekolah" value="${stats?.prasekolah || 12}" required>
          </div>
         <div class="form-group">
  <label class="form-label" for="prasekolahSwasta">Prasekolah Swasta</label>
  <input type="number" class="form-input" id="prasekolahSwasta"
    value="${stats?.prasekolah_swasta || 3}" required>
</div>
            <div class="form-group">
  <label class="form-label" for="swastaRendah">Sekolah Swasta Rendah</label>
  <input type="number" class="form-input" id="swastaRendah"
    value="${stats?.sekolah_swasta_rendah || 2}" required>
</div>

<div class="form-group">
  <label class="form-label" for="swastaMenengah">Sekolah Swasta Menengah</label>
  <input type="number" class="form-input" id="swastaMenengah"
    value="${stats?.sekolah_swasta_menengah || 1}" required>
</div>
>
          </div>
          <div class="form-group">
            <label class="form-label" for="tingkatanEnam">Pusat Tingkatan Enam</label>
            <input type="number" class="form-input" id="tingkatanEnam" value="${stats?.tingkatan_enam || 4}" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="ppkiMenengah">PPKI Menengah</label>
            <input type="number" class="form-input" id="ppkiMenengah" value="${stats?.ppki_menengah || 2}" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="ppkiRendah">PPKI Rendah</label>
            <input type="number" class="form-input" id="ppkiRendah" value="${stats?.ppki_rendah || 5}" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="jumlahMurid">Jumlah Murid</label>
            <input type="number" class="form-input" id="jumlahMurid" value="${stats?.jumlah_murid || 18395}" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="jumlahGuru">Jumlah Guru</label>
            <input type="number" class="form-input" id="jumlahGuru" value="${stats?.jumlah_guru || 625}" required>
          </div>
          <button type="submit" class="btn">Simpan</button>
          <button type="button" class="btn btn-delete" onclick="closeModal()">Batal</button>
        </form>
      `;
      modal.classList.add('active');

      document.getElementById('statsForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const statsData = {
          type: 'school_stats',
          sekolah_rendah: parseInt(document.getElementById('sekolahRendah').value),
          sekolah_menengah: parseInt(document.getElementById('sekolahMenengah').value),
          sekolah_k9: parseInt(document.getElementById('sekolahK9').value),
          prasekolah: parseInt(document.getElementById('prasekolah').value),
         prasekolah_swasta: parseInt(document.getElementById('prasekolahSwasta').value),
         sekolah_swasta_rendah: parseInt(document.getElementById('swastaRendah').value),
          sekolah_swasta_menengah: parseInt(document.getElementById('swastaMenengah').value),
          tingkatan_enam: parseInt(document.getElementById('tingkatanEnam').value),
          ppki_menengah: parseInt(document.getElementById('ppkiMenengah').value),
          ppki_rendah: parseInt(document.getElementById('ppkiRendah').value),
          jumlah_murid: parseInt(document.getElementById('jumlahMurid').value),
          jumlah_guru: parseInt(document.getElementById('jumlahGuru').value),
          timestamp: new Date().toISOString()
        };

        let result;
        if (stats) {
          result = await window.dataSdk.update({ ...stats, ...statsData });
        } else {
          result = await window.dataSdk.create(statsData);
        }

        if (result.isOk) {
          showToast('‚úÖ Data sekolah berjaya dikemaskini');
          closeModal();
        } else {
          showToast('‚ùå Gagal kemaskini data sekolah');
        }
      });
    }

    async function addSharing() {
      const modal = document.getElementById('genericModal');
      document.getElementById('modalTitle').textContent = 'Tambah Perkongsian';
      document.getElementById('modalBody').innerHTML = `
        <form id="sharingForm">
          <div class="form-group">
            <label class="form-label" for="sharingTitle">Tajuk</label>
            <input type="text" class="form-input" id="sharingTitle" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="sharingAuthor">Penulis</label>
            <input type="text" class="form-input" id="sharingAuthor" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="sharingDate">Tarikh</label>
            <input type="date" class="form-input" id="sharingDate" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="sharingDescription">Penerangan</label>
            <textarea class="form-textarea" id="sharingDescription" rows="4" required></textarea>
          </div>
          <div class="form-group">
            <label class="form-label" for="sharingLink">Link Muat Turun</label>
            <input type="url" class="form-input" id="sharingLink" placeholder="https://contoh.com/perkongsian.pdf">
          </div>
          <button type="submit" class="btn">Simpan</button>
          <button type="button" class="btn btn-delete" onclick="closeModal()">Batal</button>
        </form>
      `;
      modal.classList.add('active');

      document.getElementById('sharingForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const result = await window.dataSdk.create({
          type: 'sharing',
          title: document.getElementById('sharingTitle').value,
          author: document.getElementById('sharingAuthor').value,
          date: document.getElementById('sharingDate').value,
          description: document.getElementById('sharingDescription').value,
          download_link: document.getElementById('sharingLink').value,
          likes: 0,
          views: 0,
          timestamp: new Date().toISOString()
        });

        if (result.isOk) {
          showToast('‚úÖ Perkongsian berjaya ditambah');
          closeModal();
        } else {
          showToast('‚ùå Gagal tambah perkongsian');
        }
      });
    }

    async function editSharing(id) {
      const sharing = allData.find(d => d.__backendId === id);
      if (!sharing) return;

      const modal = document.getElementById('genericModal');
      document.getElementById('modalTitle').textContent = 'Edit Perkongsian';
      document.getElementById('modalBody').innerHTML = `
        <form id="editSharingForm">
          <div class="form-group">
            <label class="form-label" for="editSharingTitle">Tajuk</label>
            <input type="text" class="form-input" id="editSharingTitle" value="${sharing.title}" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="editSharingAuthor">Penulis</label>
            <input type="text" class="form-input" id="editSharingAuthor" value="${sharing.author}" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="editSharingDate">Tarikh</label>
            <input type="date" class="form-input" id="editSharingDate" value="${sharing.date}" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="editSharingDescription">Penerangan</label>
            <textarea class="form-textarea" id="editSharingDescription" rows="4" required>${sharing.description}</textarea>
          </div>
          <div class="form-group">
            <label class="form-label" for="editSharingLink">Link Muat Turun</label>
            <input type="url" class="form-input" id="editSharingLink" value="${sharing.download_link || ''}" placeholder="https://contoh.com/perkongsian.pdf">
          </div>
          <button type="submit" class="btn">Simpan</button>
          <button type="button" class="btn btn-delete" onclick="closeModal()">Batal</button>
        </form>
      `;
      modal.classList.add('active');

      document.getElementById('editSharingForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const result = await window.dataSdk.update({
          ...sharing,
          title: document.getElementById('editSharingTitle').value,
          author: document.getElementById('editSharingAuthor').value,
          date: document.getElementById('editSharingDate').value,
          description: document.getElementById('editSharingDescription').value,
          download_link: document.getElementById('editSharingLink').value
        });

        if (result.isOk) {
          showToast('‚úÖ Perkongsian berjaya dikemaskini');
          closeModal();
        } else {
          showToast('‚ùå Gagal kemaskini perkongsian');
        }
      });
    }

    function renderPekeliling() {
      const content = document.getElementById('contentArea');
      const pekeliling = allData.filter(d => d.type === 'circular');
      
      content.innerHTML = `
        <div class="card">
          <h2 class="card-title">üìã Pekeliling</h2>
          ${isAdmin ? '<button class="btn" onclick="addCircular()">+ Tambah Pekeliling</button>' : ''}
          
          <div class="grid">
            ${pekeliling.length === 0 ? 
              '<p style="grid-column: 1/-1; text-align: center; color: #999; padding: 2rem;">Tiada pekeliling tersedia</p>' :
              pekeliling.map(item => {
                const likes = item.likes || 0;
                const views = item.views || 0;
                const commentCount = allData.filter(d => d.type === 'interaction' && d.parent_id === item.__backendId && d.interaction_type === 'comment').length;
                
                return `
                <div class="grid-item">
                  <div style="background: linear-gradient(135deg, #007bff 0%, #00bfff 100%); color: white; padding: 0.5rem 1rem; border-radius: 10px; display: inline-block; margin-bottom: 1rem; font-weight: 600;">
                    ${item.category || 'Pekeliling'}
                  </div>
                  <h3 style="color: #007bff; margin-bottom: 0.8rem; font-size: 1.2rem;">${item.title}</h3>
                  <p style="line-height: 1.6; color: #666; margin-bottom: 0.8rem;">${item.description || ''}</p>
                  <p style="font-size: 0.85rem; color: #999; margin-bottom: 0.3rem;">üìÖ ${item.date || ''}</p>
                  <p style="font-size: 0.85rem; color: #999;">üìÑ Rujukan: ${item.content || '-'}</p>
                  ${item.download_link ? `<p style="font-size: 0.9rem; color: #28a745; margin-top: 0.5rem;">üîó <a href="${item.download_link}" target="_blank" rel="noopener noreferrer" style="color: #28a745; text-decoration: underline;">Muat Turun Pekeliling</a></p>` : ''}
                  
                  <div class="interaction-buttons">
                    <button class="btn btn-small btn-like" onclick="toggleLike('${item.__backendId}')">
                      ‚ù§Ô∏è Suka (${likes})
                    </button>
                    <button class="btn btn-small btn-view" onclick="viewItem('${item.__backendId}')">
                      üëÅÔ∏è Lihat (${views})
                    </button>
                    <button class="btn btn-small btn-comment" onclick="showComments('${item.__backendId}', 'circular')">
                      üí¨ Komen (${commentCount})
                    </button>
                  </div>
                  ${isAdmin ? `
                    <div style="margin-top: 0.5rem;">
                      <button class="btn btn-small" onclick="editCircular('${item.__backendId}')">‚úèÔ∏è Edit</button>
                      <button class="btn btn-delete btn-small" onclick="deleteItem('${item.__backendId}')">Padam</button>
                    </div>
                  ` : ''}
                </div>
              `;
              }).join('')
            }
          </div>
        </div>
      `;
    }

    async function addCircular() {
      const modal = document.getElementById('genericModal');
      document.getElementById('modalTitle').textContent = 'Tambah Pekeliling';
      document.getElementById('modalBody').innerHTML = `
        <form id="circularForm">
          <div class="form-group">
            <label class="form-label" for="circularTitle">Tajuk Pekeliling</label>
            <input type="text" class="form-input" id="circularTitle" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="circularCategory">Kategori</label>
            <input type="text" class="form-input" id="circularCategory" placeholder="Contoh: Pekeliling KPM, Pekeliling JPM">
          </div>
          <div class="form-group">
            <label class="form-label" for="circularDate">Tarikh</label>
            <input type="date" class="form-input" id="circularDate" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="circularReference">No. Rujukan</label>
            <input type="text" class="form-input" id="circularReference" placeholder="Contoh: KP(BS)8543/Jld.II(25)">
          </div>
          <div class="form-group">
            <label class="form-label" for="circularDescription">Penerangan</label>
            <textarea class="form-textarea" id="circularDescription" rows="4" required></textarea>
          </div>
          <div class="form-group">
            <label class="form-label" for="circularLink">Link Muat Turun</label>
            <input type="url" class="form-input" id="circularLink" placeholder="https://contoh.com/pekeliling.pdf">
          </div>
          <button type="submit" class="btn">Simpan</button>
          <button type="button" class="btn btn-delete" onclick="closeModal()">Batal</button>
        </form>
      `;
      modal.classList.add('active');

      document.getElementById('circularForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const result = await window.dataSdk.create({
          type: 'circular',
          title: document.getElementById('circularTitle').value,
          category: document.getElementById('circularCategory').value,
          date: document.getElementById('circularDate').value,
          content: document.getElementById('circularReference').value,
          description: document.getElementById('circularDescription').value,
          download_link: document.getElementById('circularLink').value,
          likes: 0,
          views: 0,
          timestamp: new Date().toISOString()
        });

        if (result.isOk) {
          showToast('‚úÖ Pekeliling berjaya ditambah');
          closeModal();
        } else {
          showToast('‚ùå Gagal tambah pekeliling');
        }
      });
    }

    async function editCircular(id) {
      const circular = allData.find(d => d.__backendId === id);
      if (!circular) return;

      const modal = document.getElementById('genericModal');
      document.getElementById('modalTitle').textContent = 'Edit Pekeliling';
      document.getElementById('modalBody').innerHTML = `
        <form id="editCircularForm">
          <div class="form-group">
            <label class="form-label" for="editCircularTitle">Tajuk Pekeliling</label>
            <input type="text" class="form-input" id="editCircularTitle" value="${circular.title}" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="editCircularCategory">Kategori</label>
            <input type="text" class="form-input" id="editCircularCategory" value="${circular.category || ''}">
          </div>
          <div class="form-group">
            <label class="form-label" for="editCircularDate">Tarikh</label>
            <input type="date" class="form-input" id="editCircularDate" value="${circular.date}" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="editCircularReference">No. Rujukan</label>
            <input type="text" class="form-input" id="editCircularReference" value="${circular.content || ''}">
          </div>
          <div class="form-group">
            <label class="form-label" for="editCircularDescription">Penerangan</label>
            <textarea class="form-textarea" id="editCircularDescription" rows="4" required>${circular.description}</textarea>
          </div>
          <div class="form-group">
            <label class="form-label" for="editCircularLink">Link Muat Turun</label>
            <input type="url" class="form-input" id="editCircularLink" value="${circular.download_link || ''}" placeholder="https://contoh.com/pekeliling.pdf">
          </div>
          <button type="submit" class="btn">Simpan</button>
          <button type="button" class="btn btn-delete" onclick="closeModal()">Batal</button>
        </form>
      `;
      modal.classList.add('active');

      document.getElementById('editCircularForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const result = await window.dataSdk.update({
          ...circular,
          title: document.getElementById('editCircularTitle').value,
          category: document.getElementById('editCircularCategory').value,
          date: document.getElementById('editCircularDate').value,
          content: document.getElementById('editCircularReference').value,
          description: document.getElementById('editCircularDescription').value,
          download_link: document.getElementById('editCircularLink').value
        });

        if (result.isOk) {
          showToast('‚úÖ Pekeliling berjaya dikemaskini');
          closeModal();
        } else {
          showToast('‚ùå Gagal kemaskini pekeliling');
        }
      });
    }

    function showToast(message) {
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.textContent = message;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    if (localStorage.getItem('darkMode') === 'true') {
      document.body.classList.add('dark-mode');
      document.getElementById('themeToggle').textContent = '‚òÄ';
    }

    window.onload = init;
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9ad8d162a29ccf0c',t:'MTc2NTY2NDEwMy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html> 


























